---
title: "[ãƒ„ãƒ¼ãƒ«ç·¨]OpenAI GPTsã®APIç‰ˆã€AssistantsAPIã®ä»•æ§˜ã‚’èª­ã‚“ã§ã„ã"
emoji: "ğŸ˜¸"
type: "tech"
topics:
  - "api"
  - "gpt"
  - "openai"
published: true
published_at: "2024-01-06 16:00"
---

# ã¯ã˜ã‚ã«
æ¦‚è¦ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ä»•çµ„ã¿ã€ã¨è¦‹ã¦ã„ã£ãŸã®ã§ã€æœ€å¾Œã¨ãªã‚‹ãƒ„ãƒ¼ãƒ«ã®ç« ã‚’è¦‹ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

https://platform.openai.com/docs/assistants/tools/code-interpreter

å‰å›ã®è¨˜äº‹ã¯ã“ã¡ã‚‰
https://zenn.dev/kat/articles/ee0d8a7679963a

# æ§‹æˆ
**ãƒ„ãƒ¼ãƒ«**ã®ãƒšãƒ¼ã‚¸ã¯ã€4ã¤ã®æ§‹æˆã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚
- ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿
- çŸ¥è­˜ã®æ¤œç´¢
- é–¢æ•°å‘¼ã³å‡ºã—
- ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«


## ãƒ„ãƒ¼ãƒ«
ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAPIã«ãŠã‘ã‚‹ãƒ„ãƒ¼ãƒ«ã¨ã¯ã€å¾“æ¥ãƒ¦ãƒ¼ã‚¶ã®æŒ‡ç¤ºã«å¯¾ã—ã¦è¨€èªãƒ¢ãƒ‡ãƒ«ãŒå›ç­”ã‚’ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ã ã‘ã§ã‚ã‚‹ã“ã¨ã«è¿½åŠ ã—ã¦ã€å‡¦ç†ã‚’ã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹æ©Ÿèƒ½ã§ã™ã€‚
OpenAI ãŒæä¾›ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨ã«ã¯è¿½åŠ æ–™é‡‘ãŒã‹ã‹ã‚Šã¾ã™ã€‚
ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã®ä¾¡æ ¼è¨­å®šã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€ãƒ˜ãƒ«ãƒ—ã‚»ãƒ³ã‚¿ãƒ¼ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ã€‚
ã¨ã‚ã‚Šã¾ã™ãŒã€çµè«–çš„ã«ã¯ã€ãƒ„ãƒ¼ãƒ«ã®ãƒšãƒ¼ã‚¸ã«æ›¸ã„ã¦ã‚ã‚‹å†…å®¹ä»¥ä¸Šã®è©³ç´°æƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
ã‚€ã—ã‚ã€ãƒ„ãƒ¼ãƒ«ã®ãƒšãƒ¼ã‚¸ã®æ–¹ãŒè©³ç´°æ›¸ã„ã¦ã„ã‚‹ã¾ã§ã‚ã‚‹ã€‚

https://help.openai.com/en/articles/8550641-assistants-api


## ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ï¼ˆCode Interpreterï¼‰
ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAPI ãŒã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å®Ÿè¡Œç’°å¢ƒã§ Python ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¦å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ã•ã¾ã–ã¾ãªãƒ‡ãƒ¼ã‚¿ã¨å½¢å¼ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã—ã€ãƒ‡ãƒ¼ã‚¿ã¨ã‚°ãƒ©ãƒ•ã®ç”»åƒã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¯ã‚³ãƒ¼ãƒ‰ã‚’ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã—ã¦ã€é›£ã—ã„ã‚³ãƒ¼ãƒ‰ã‚„æ•°å­¦ã®å•é¡Œã‚’è§£æ±ºã§ãã¾ã™ã€‚ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¯ã€å®Ÿè¡Œã«å¤±æ•—ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ãŸå ´åˆã€ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡ŒãŒæˆåŠŸã™ã‚‹ã¾ã§åˆ¥ã®ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œã‚’è©¦ã¿ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’åå¾©å‡¦ç†ã§ãã¾ã™ã€‚

### ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã®æ–™é‡‘
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚ãŸã‚Š 0.03 ãƒ‰ãƒ«ã§ã™ã€‚
- å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ 1æ™‚é–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚Šã¾ã™ã€‚
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã‚¹ãƒ¬ãƒƒãƒ‰æ¯ã«åˆ¥ã€…ã€‚
  ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãŒ 2ã¤ã®ç•°ãªã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ (ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã« 1ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãªã©) ã§åŒæ™‚ã«ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’å‘¼ã³å‡ºã™å ´åˆã€2ã¤ã®ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
- åŒä¸€ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚ï¼‘æ™‚é–“ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã‚‹ãŸã‚ã€ï¼‘ã‚¹ãƒ¬ãƒƒãƒ‰ã‚ãŸã‚Šã§ï¼’ã‚»ãƒƒã‚·ãƒ§ãƒ³ä»¥ä¸Šã‚‚ã‚ã‚Šå¾—ã‚‹ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒã˜ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’1æ™‚é–“æ“ä½œã—ãŸå ´åˆã€æ–™é‡‘ã¯1ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†ã€‚

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ä½¿ç”¨ã—ã¦ã„ãªã„æ—¥ã¯èª²é‡‘ã•ã‚Œãªã„ã¨ã„ã†ã®ã¨ã€
ã‚»ãƒƒã‚·ãƒ§ãƒ³å˜ä½ã§èª²é‡‘ã•ã‚Œã‚‹ãŸã‚ã€0.03ãƒ‰ãƒ« Ã— 3ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§0.09ãƒ‰ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/f9c1d987b898-20231231.png)

### ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ã®æœ‰åŠ¹åŒ–
Assistantã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`tools`ã«`code_interpreter`ã‚’æ¸¡ã™ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

```shell
curl https://api.openai.com/v1/assistants \
  -u :$OPENAI_API_KEY \
  -H 'Content-Type: application/json' \
  -H 'OpenAI-Beta: assistants=v1' \
  -d '{
    "instructions": "You are a personal math tutor. When asked a math question, write and run code to answer the question.",
    "tools": [
      { "type": "code_interpreter" }
    ],
    "model": "gpt-4-1106-preview"
  }'
```

æ¬¡ã«ãƒ¢ãƒ‡ãƒ«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ€§è³ªã«åŸºã¥ã„ã¦ã€å®Ÿè¡Œæ™‚ã«ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’ã„ã¤å‘¼ã³å‡ºã™ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚
ã“ã®å‹•ä½œã¯ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æŒ‡ç¤ºã™ã‚‹äº‹ã«ã‚ˆã£ã¦ä¿ƒé€²ã§ãã¾ã™ã€‚
(ã€Œã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ãã ã•ã„ã€ãªã©)
â€»ã‚ãã¾ã§ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã®ã¯ãƒ¢ãƒ‡ãƒ«ã®åˆ¤æ–­ã«ã‚ˆã‚‹ã‘ã‚Œã©ã€ãƒ¦ãƒ¼ã‚¶ã®æŒ‡ç¤ºãŒã‚ã‚Œã°ã€ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’ã‚ˆã‚Šä½¿ç”¨ã—ã¦ãã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã¾ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚
ã“ã®è¾ºã¯å®Ÿéš›è§¦ã£ãŸæ„Ÿè¦šã¨åŒæ§˜ã§ã™ã€‚

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã«æ¸¡ã™
ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’è§£æã§ãã¾ã™ã€‚
ã“ã‚Œã¯ã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«æä¾›ã™ã‚‹å ´åˆã€ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ†æã®ãŸã‚ã«ç‹¬è‡ªã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å ´åˆã«ä¾¿åˆ©ã§ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ç”¨ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€æ¤œç´¢ç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚Œãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
â€»æ¤œç´¢ç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ã€ŒãƒŠãƒ¬ãƒƒã‚¸ã®æ¤œç´¢ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§

ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã§æ¸¡ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã“ã®ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã™ã¹ã¦ã®å®Ÿè¡Œã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

```shell
# Upload a file with an "assistants" purpose
curl https://api.openai.com/v1/files \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -F purpose="assistants" \
  -F file="@/path/to/mydata.csv"

# Create an assistant using the file ID
curl https://api.openai.com/v1/assistants \
  -u :$OPENAI_API_KEY \
  -H 'Content-Type: application/json' \
  -H 'OpenAI-Beta: assistants=v1' \
  -d '{
    "instructions": "You are a personal math tutor. When asked a math question, write and run code to answer the question.",
    "tools": [{"type": "code_interpreter"}],
    "model": "gpt-4-1106-preview",
    "file_ids": ["file_123abc456"]
  }'
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "id": "asst_rRYWX1QsJPvR2mIKC4Uf0WoW",
  "object": "assistant",
  "created_at": 1703293867,
  "name": null,
  "description": null,
  "model": "gpt-4-1106-preview",
  "instructions": "You are a personal math tutor. When asked a math question, write and run code to answer the question.",
  "tools": [
    {
      "type": "code_interpreter"
    }
  ],
  "file_ids": [
    "file-EHaW1HlXihGdQfdVqSwAAQsj"
  ],
  "metadata": {}
}
```

```shell
curl https://api.openai.com/v1/threads/thread_abc123/messages \
  -u :$OPENAI_API_KEY \
  -H 'Content-Type: application/json' \
  -H 'OpenAI-Beta: assistants=v1' \
  -d '{
    "role": "user",
    "content": "I need to solve the equation `3x + 11 = 14`. Can you help me?",
    "file_ids": ["file_123abc456"]
  }'
```

- ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«å¯¾ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¸¡ã›ã‚‹ã€‚
- ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«æ¸¡ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã§å‚ç…§å¯èƒ½ã€‚
- ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«æ¸¡ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ã©ã®å®Ÿè¡Œã§ã‚‚å‚ç…§å¯èƒ½ã€‚
- ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã§æ·»ä»˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã¯æ–™é‡‘ã¯ç™ºç”Ÿã—ãªã„ã€‚
- æ¤œç´¢ãƒ„ãƒ¼ãƒ«ãŒå–å¾—ã—ã¦ããŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã¯æ–™é‡‘ãŒç™ºç”Ÿã™ã‚‹ã€‚
- ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¹ãƒ¬ãƒƒãƒ‰å˜ä½ã§ã‚‚æ¸¡ã›ã‚‹ã€‚ã“ã®å ´åˆã¯æ¸¡ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§ã—ã‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã§ããªã„ã€‚
- ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¤§ã‚µã‚¤ã‚ºã¯ 512MB
- ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã¯ã€`.csv`ã€`.pdf`ã‚„`.json`ãªã©ã€ã•ã¾ã–ã¾ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ
â€»ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ (ãŠã‚ˆã³å¯¾å¿œã™ã‚‹ MIME ã‚¿ã‚¤ãƒ—) ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ã€Œã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§

### ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸç”»åƒã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Š
APIã®ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã¯ã€å›³å¼ã®ç”»åƒã®ç”Ÿæˆã‚„ã€CSVã‚„PDFãªã©ã®ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã‚‚è¡Œã„ã¾ã™ã€‚
ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯æ¬¡ã® 2ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚

1. ç”»åƒ
2. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ« (ä¾‹:csvã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«)
`file_id`ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ã¨ãã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¿œç­”ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

```
{
    "id": "msg_abc123",
    "object": "thread.message",
    "created_at": 1698964262,
    "thread_id": "thread_abc123",
    "role": "assistant",
    "content": [
    {
      "type": "image_file",
      "image_file": {
        "file_id": "file-abc123"
      }
    }
  ]
  # ...
}
```

ãƒ•ã‚¡ã‚¤ãƒ«ID ã‚’FilesAPIã«æ¸¡ã™ã“ã¨ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆä½œæˆæ™‚ã«ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«è¿½åŠ ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ãªã„ã‚ˆã†ã§ã—ãŸã€‚

1. ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ãƒ³ãƒ‰ã§ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¨ä¼šè©±ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã€‚
![](https://storage.googleapis.com/zenn-user-upload/5d639e70f595-20231230.png)

2. ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
ã‚„ã‚Šå–ã‚Šã—ãŸä¼šè©±ã®ãƒ‘ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«IDãŒæŒ¯ã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½œæˆã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/c18b97f06758-20231230.png)

â€»è›‡è¶³æ°—å‘³ã§ã™ãŒã€ã‚¹ãƒ¬ãƒƒãƒ‰ã§ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‹ã‚‰ã¯å‚ç…§ã§ãã¾ã›ã‚“ãŒã€ã‚¹ãƒ¬ãƒƒãƒ‰ã®ä¸€è¦§ã‚„ã‚¹ãƒ¬ãƒƒãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è©³ç´°ã‹ã‚‰å‚ç…§å¯èƒ½ã€‚
ãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ãƒ³ãƒ‰ã®ã‚„ã‚Šå–ã‚Šã¯ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚‹ã¨æ¶ˆãˆã¦ã—ã¾ã†ã®ã§ã€æ”¹ã‚ã¦ç¢ºèªã—ãŸã„å ´åˆã¯APIçµŒç”±ã§ç¢ºèªã™ã‚‹ã—ã‹ãªã•ãã†ã§ã™ã€‚
```
curl https://api.openai.com/v1/threads/thread_vQQFfpiJiUedUiKzMKcEJO3Q/messages \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1"

{
  "object": "list",
  "data": [
    {
      "id": "msg_76FwFsm34RIbwc6lF2VL3AgO",
      "object": "thread.message",
      "created_at": 1703918983,
      "thread_id": "thread_vQQFfpiJiUedUiKzMKcEJO3Q",
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": {
            "value": "é–¢æ±åœ°æ–¹ã®éƒ½é“åºœçœŒã‚’ãƒªã‚¹ãƒˆåŒ–ã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ï¼š\n\n[é–¢æ±åœ°æ–¹ã®éƒ½é“åºœçœŒ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](sandbox:/mnt/data/kanto_prefectures.csv)",
            "annotations": [
              {
                "type": "file_path",
                "text": "sandbox:/mnt/data/kanto_prefectures.csv",
                "start_index": 79,
                "end_index": 118,
                "file_path": {
                  "file_id": "file-PLrFUYMh1VQSTkWQHH4PGltH"
                }
              }
            ]
          }
        }
      ],
      "file_ids": [
        "file-PLrFUYMh1VQSTkWQHH4PGltH"
      ],
      "assistant_id": "asst_TUkrMHYAlwoGEWOAMTU1G2Ez",
      "run_id": "run_HqUzHACgjSYZf7B7WHxFjFHd",
      "metadata": {}
    },
    â€¦ã€€ä»¥ä¸‹ç•¥
```
ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã‚‹å ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯`annotations`ã«ãƒªã‚¹ãƒˆã•ã‚Œã¾ã™ã€‚

3. ã‚¹ãƒ¬ãƒƒãƒ‰ã§ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```
curl https://api.openai.com/v1/files/file-PLrFUYMh1VQSTkWQHH4PGltH/content \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  --output prefecture.csv

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100    94    0    94    0     0    229      0 --:--:-- --:--:-- --:--:--   229

cat prefecture.csv 
éƒ½é“åºœçœŒ
æ±äº¬éƒ½
ç¥å¥ˆå·çœŒ
åŸ¼ç‰çœŒ
åƒè‘‰çœŒ
èŒ¨åŸçœŒ
æ ƒæœ¨çœŒ
ç¾¤é¦¬çœŒ
```

ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå¤–ã§ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã—ãŸå ´åˆã€ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚
```shell
curl https://api.openai.com/v1/files/file-EHaW1HlXihGdQfdVqSwAAQsj/content \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  --output mydata.csv

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   165  100   165    0     0    495      0 --:--:-- --:--:-- --:--:--   494

cat mydata.csv 
{
  "error": {
    "message": "Not allowed to download files of purpose: assistants",
    "type": "invalid_request_error",
    "param": null,
    "code": null
  }
}
```


### ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ã®å…¥å‡ºåŠ›ãƒ­ã‚°
`steps`APIã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã‚’å‘¼ã³å‡ºã—ãŸå®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—ã®æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™ã€‚
å®Ÿè¡Œã‚¹ãƒ†ãƒƒãƒ—ã®ä¸­ã«ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã®inputã¨outputsãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
inputã«ã¯å®Ÿè¡Œã—ãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã€outputã«ã¯ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œã«ã‚ˆã£ã¦å‡ºåŠ›ã•ã‚ŒãŸãƒ­ã‚°ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```shell
curl https://api.openai.com/v1/threads/{ã‚¹ãƒ¬ãƒƒãƒ‰ID}/runs/{å®Ÿè¡ŒID}/steps \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1" \
```

```json
{
  "object": "list",
  "data": [
    {
      "id": "step_fZV62VZR3oJts3eL5g1YeWO0",
      "object": "thread.run.step",
      "created_at": 1703918983,
      "run_id": "run_HqUzHACgjSYZf7B7WHxFjFHd",
      "assistant_id": "asst_TUkrMHYAlwoGEWOAMTU1G2Ez",
      "thread_id": "thread_vQQFfpiJiUedUiKzMKcEJO3Q",
      "type": "message_creation",
      "status": "completed",
      "cancelled_at": null,
      "completed_at": 1703918987,
      "expires_at": null,
      "failed_at": null,
      "last_error": null,
      "step_details": {
        "type": "message_creation",
        "message_creation": {
          "message_id": "msg_76FwFsm34RIbwc6lF2VL3AgO"
        }
      }
    },
    {
      "id": "step_WiiCOqqw6l2G3OSV7yWjQeHd",
      "object": "thread.run.step",
      "created_at": 1703918967,
      "run_id": "run_HqUzHACgjSYZf7B7WHxFjFHd",
      "assistant_id": "asst_TUkrMHYAlwoGEWOAMTU1G2Ez",
      "thread_id": "thread_vQQFfpiJiUedUiKzMKcEJO3Q",
      "type": "tool_calls",
      "status": "completed",
      "cancelled_at": null,
      "completed_at": 1703918983,
      "expires_at": null,
      "failed_at": null,
      "last_error": null,
      "step_details": {
        "type": "tool_calls",
        "tool_calls": [
          {
            "id": "call_zW14v791RIHBYyfBD9LMe0r1",
            "type": "code_interpreter",
            "code_interpreter": {
              "input": "import csv\n\n# é–¢æ±åœ°æ–¹ã®éƒ½é“åºœçœŒã®ãƒªã‚¹ãƒˆ\nkanto_prefectures = [\"æ±äº¬éƒ½\", \"ç¥å¥ˆå·çœŒ\", \"åŸ¼ç‰çœŒ\", \"åƒè‘‰çœŒ\", \"èŒ¨åŸçœŒ\", \"æ ƒæœ¨çœŒ\", \"ç¾¤é¦¬çœŒ\"]\n\n# ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹\nfile_path = '/mnt/data/kanto_prefectures.csv'\n\n# CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜\nwith open(file_path, mode='w', newline='', encoding='utf-8') as file:\n    writer = csv.writer(file)\n    writer.writerow([\"éƒ½é“åºœçœŒ\"])  # ãƒ˜ãƒƒãƒ€ãƒ¼\n    for prefecture in kanto_prefectures:\n        writer.writerow([prefecture])\n\nfile_path",
              "outputs": [
                {
                  "type": "logs",
                  "logs": "'/mnt/data/kanto_prefectures.csv'"
                }
              ]
            }
          }
        ]
      }
    }
  ],
  "first_id": "step_fZV62VZR3oJts3eL5g1YeWO0",
  "last_id": "step_WiiCOqqw6l2G3OSV7yWjQeHd",
  "has_more": false
}
```

`input`ã®éƒ¨åˆ†ã«ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ãŒç”Ÿæˆã—ãŸpythonã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
```python
import csv

# é–¢æ±åœ°æ–¹ã®éƒ½é“åºœçœŒã®ãƒªã‚¹ãƒˆ
kanto_prefectures = ["æ±äº¬éƒ½", "ç¥å¥ˆå·çœŒ", "åŸ¼ç‰çœŒ", "åƒè‘‰çœŒ", "èŒ¨åŸçœŒ", "æ ƒæœ¨çœŒ", "ç¾¤é¦¬çœŒ"]

# ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
file_path = '/mnt/data/kanto_prefectures.csv'

# CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
with open(file_path, mode='w', newline='', encoding='utf-8') as file:
    writer = csv.writer(file)
    writer.writerow(["éƒ½é“åºœçœŒ"])  # ãƒ˜ãƒƒãƒ€ãƒ¼
    for prefecture in kanto_prefectures:
        writer.writerow([prefecture])

file_path
```
æœ€å¾Œã®è¡Œã®`file_path`ãŒè¬ã§ã™ãŒã€csvãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã¾ã™ã€‚



## çŸ¥è­˜ã®æ¤œç´¢æ©Ÿèƒ½ï¼ˆKnowledge Retrievalï¼‰
æ¤œç´¢æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ç‹¬è‡ªã®è£½å“æƒ…å ±ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æä¾›ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãªã©ã€ãƒ¢ãƒ‡ãƒ«ã®å¤–éƒ¨ã‹ã‚‰ã®çŸ¥è­˜ã§ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãŒå¼·åŒ–ã•ã‚Œã¾ã™ã€‚
ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«è¿½åŠ ã™ã‚‹ã¨ã€OpenAIã¯è‡ªå‹•çš„ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ãƒãƒ£ãƒ³ã‚¯åŒ–ã—ã€åŸ‹ã‚è¾¼ã¿ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã¦ä¿å­˜ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã«ç­”ãˆã‚‹ãŸã‚ã«é–¢é€£ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å–å¾—ã™ã‚‹ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### æ¤œç´¢æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–
ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`tools`ã«`retrieval`ã‚’æ¸¡ã™ã“ã¨ã§ã€æ¤œç´¢æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

```shell
curl https://api.openai.com/v1/assistants \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1" \
  -d '{
    "instructions": "You are a customer support chatbot. Use your knowledge base to best respond to customer queries.",
    "tools": [{"type": "retrieval"}],
    "model": "gpt-4-1106-preview"
  }'
```

### æ¤œç´¢æ©Ÿèƒ½ã®æ–™é‡‘
- æ·»ä»˜ã•ã‚ŒãŸã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«è‡ªå‹•çš„ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚Œã¾ã™
- ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã”ã¨ã« 1æ—¥ã‚ãŸã‚Š 0.20 ãƒ‰ãƒ«/GB ãŒèª²é‡‘ã•ã‚Œã¾ã™ã€‚
- Modify Assistantã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€æ¤œç´¢æ©Ÿèƒ½ã‚’æœ‰åŠ¹/ç„¡åŠ¹ã«ã§ãã¾ã™ã€‚

â€»ä¸Šã®è§£èª¬è¦‹ã¦ã€ã‚ã¾ã‚Šä½¿ç”¨ã—ã¦ã„ãªã„ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ ã—ãŸã¾ã¾ã ã¨æ–™é‡‘ã¿ã«1æ—¥å½“ãŸã‚Š0.20 ãƒ‰ãƒ«/GBã«ã¤ã„ã¦ã§ã™ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ãŸã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAPIã ã¨æ¯æ—¥èª²é‡‘ã•ã‚Œã‚‹ã®ã‹ã¨æ€ã‚ã‚Œãã†ã§ã™ãŒã€å®Ÿéš›ã®æ–™é‡‘è¦‹ãŸæ„Ÿã˜ã€ä½¿ç”¨ã—ãŸæ—¥ã®ã¿ã®èª²é‡‘ã®ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/c78e471a9e3d-20231231.png)

### ä½¿ã„æ–¹
æ¬¡ã«ãƒ¢ãƒ‡ãƒ«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«åŸºã¥ã„ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã„ã¤å–å¾—ã™ã‚‹ã‹ã‚’æ±ºå®šã—ã¾ã™ã€‚
ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAPI ã¯ã€æ¬¡ã®2ã¤ã®å–å¾—æ‰‹æ³•ã‹ã‚‰è‡ªå‹•çš„ã«é¸æŠã—ã¾ã™ã€‚

1. çŸ­ã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ¸¡ã™
2. é•·ã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã¦ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã‚’å®Ÿè¡Œ

ã¨ã‚ã‚Šã¾ã™ãŒã€æ­£ç›´ä½•ã‚’æ„å‘³ã—ã¦ã„ã‚‹ã®ã‹ä¸æ˜ã§ã—ãŸã€‚
æ„å‘³ãŒåˆ†ã‹ã£ãŸã‚‰åŠ ç­†ä¿®æ­£ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### æ¤œç´¢æ©Ÿèƒ½ã®ãŸã‚ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã¨åŒæ§˜ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«è¿½åŠ ã—ãŸã‚Šã€å€‹åˆ¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã¯ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«è¿½åŠ ã™ã‚‹æ–¹æ³•
```shell
# ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
curl https://api.openai.com/v1/files \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -F purpose="assistants" \
  -F file="@/var/www/html/README.md"

{
  "object": "file",
  "id": "file-AvvL7CYVvDIhuB3lfyAcWTk8",
  "purpose": "assistants",
  "filename": "README.md",
  "bytes": 8295,
  "created_at": 1704010979,
  "status": "processed",
  "status_details": null
}

# ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆä½œæˆï¼ˆæ¤œç´¢æ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ï¼‰
curl https://api.openai.com/v1/assistants \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1" \
  -d '{
    "instructions": "You are a customer support chatbot. Use your knowledge base to best respond to customer queries.",
    "name": "Math Tutor",
    "tools": [{"type": "retrieval"}],
    "model": "gpt-4-1106-preview",
    "file_ids": ["file-AvvL7CYVvDIhuB3lfyAcWTk8"]
  }'

{
  "id": "asst_OYM33iMGUUaMpJOB45jpm6TB",
  "object": "assistant",
  "created_at": 1704010995,
  "name": "Math Tutor",
  "description": null,
  "model": "gpt-4-1106-preview",
  "instructions": "You are a customer support chatbot. Use your knowledge base to best respond to customer queries.",
  "tools": [
    {
      "type": "retrieval"
    }
  ],
  "file_ids": [
    "file-AvvL7CYVvDIhuB3lfyAcWTk8"
  ],
  "metadata": {}
}
```

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•
```shell
curl https://api.openai.com/v1/threads/{ã‚¹ãƒ¬ãƒƒãƒ‰ID}/messages \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1" \
  -d '{
    "role": "user",
    "content": "I can not find in the PDF manual how to turn off this device.",
    "file_ids": ["{ãƒ•ã‚¡ã‚¤ãƒ«ID}"]
  }'
 ```



### æ¤œç´¢æ©Ÿèƒ½ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ¶é™
- æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ« ã‚µã‚¤ã‚ºã¯ 512 MB
- æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³ã‚µã‚¤ã‚ºã¯2,000,000 ãƒˆãƒ¼ã‚¯ãƒ³(ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã™ã‚‹ã¨ãã«è‡ªå‹•çš„ã«è¨ˆç®—ã•ã‚Œã¾ã™)
- `.pdf`ã€`.md`ã‚„`.docx`ãªã©ã€ã•ã¾ã–ã¾ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ
â€»ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ (ãŠã‚ˆã³å¯¾å¿œã™ã‚‹ MIME ã‚¿ã‚¤ãƒ—) ã®è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ã€Œã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã€‚

### æ¤œç´¢æ©Ÿèƒ½ã®æ–™é‡‘
- ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚ãŸã‚Š 1æ—¥ 0.20 ãƒ‰ãƒ«/GBã€‚
- æ¤œç´¢æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã—ãŸã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã”ã¨ã«ä¸Šè¨˜ã®1æ—¥ã‚ãŸã‚Šã®æ–™é‡‘ãŒç™ºç”Ÿã€‚
- ã¤ã¾ã‚Šã€åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã ã¨ã—ã¦ã‚‚åˆ¥ã€…ãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«æ·»ä»˜ã—ã¦ã„ã‚‹å ´åˆã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ¯ã«æ–™é‡‘ãŒç™ºç”Ÿã—ã¾ã™ã€‚
- ã“ã®æ–™é‡‘ã¯ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½•åº¦ã‚„ã‚Šå–ã‚Šã—ã¦ã‚‚å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚
- åˆ¥ãªä¾‹ã¨ã—ã¦ã€æ¤œç´¢ã‚’æœ‰åŠ¹ã«ã—ãŸã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã€å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚„ã‚Šå–ã‚Šã«åˆ¥ã€…ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€(ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«æ·»ä»˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«åŠ ãˆã¦) æ·»ä»˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã™ã¹ã¦ã«å¯¾ã—ã¦ 1æ—¥ã‚ãŸã‚Šã®æ–™é‡‘ãŒç™ºç”Ÿã—ã¾ã™ã€‚

â€»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è§£é‡ˆã™ã‚‹ã¨ä¸Šè¨˜ã®é€šã‚Šã§ã¯ã‚ã‚‹ã®ã§ã™ãŒã€å®Ÿéš›ä½¿ç”¨ã—ã¦æ–™é‡‘ã‚’ç¢ºèªã—ã¦ã¿ã¦ã‚‚0.20ãƒ‰ãƒ«ã®èª²é‡‘ã¯ç¢ºèªã§ãã¾ã›ã‚“ã§ã—ãŸã€‚


### ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ‡ã‚Šé›¢ã—ã¾ã™ã€‚

```shell
curl https://api.openai.com/v1/assistants/{ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆID}/files/{ãƒ•ã‚¡ã‚¤ãƒ«ID} \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1" \
  -X DELETE

{
  "id": "file-jadRHccSZhmFpCIQcxgqkfgV",
  "object": "assistant.file.deleted",
  "deleted": true
}
```
ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ‡ã‚Šé›¢ã™ã¨ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‹ã‚‰å‰Šé™¤ã•ã‚Œã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä»˜ããƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ–™é‡‘ã¯è«‹æ±‚ã•ã‚Œãªããªã‚Šã¾ã™ã€‚


## é–¢æ•°å‘¼ã³å‡ºã—ï¼ˆFunction Callingï¼‰
ChatCompletionsAPIã¨åŒæ§˜ã«ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAPIã¯é–¢æ•°å‘¼ã³å‡ºã—ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
é–¢æ•°å‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«é–¢æ•°ã‚’è¨˜è¿°ã—ã€å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚‹é–¢æ•°ã‚’å¼•æ•°ã¨ã¨ã‚‚ã«ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆã«è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆAPIã¯ã€å®Ÿè¡Œä¸­ã«é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¨ãã«å®Ÿè¡Œã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã™ã€‚
é–¢æ•°ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®çµæœã‚’æä¾›ã—ã¦ã€å®Ÿè¡Œã®å®Ÿè¡Œã‚’ç¶šè¡Œã§ãã¾ã™ã€‚

### é–¢æ•°ã®å®šç¾©
ã¾ãšã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã¨ãã«é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚
`function`ã®éƒ¨åˆ†ã§ã™ã€‚

```shell
curl https://api.openai.com/v1/assistants \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1" \
  -d '{
    "instructions": "You are a weather bot. Use the provided functions to answer questions.",
    "tools": [{
      "type": "function",
      "function": {
        "name": "getCurrentWeather",
        "description": "Get the weather in location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {"type": "string", "description": "The city and state e.g. San Francisco, CA"},
            "unit": {"type": "string", "enum": ["c", "f"]}
          },
          "required": ["location"]
        }
      }	
    },
    {
      "type": "function",
      "function": {
        "name": "getNickname",
        "description": "Get the nickname of a city",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {"type": "string", "description": "The city and state e.g. San Francisco, CA"}
          },
          "required": ["location"]
        }
      }	
    }],
    "model": "gpt-4-1106-preview"
  }'
```

ã“ã“ã§ã¯ã€`getCurrentWeather`ã¨`getNickname`ã¨ã„ã†2ã¤ã®é–¢æ•°ã‚’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«å®šç¾©ã—ã¦ã„ã¾ã™ã€‚


### ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«ã‚ˆã£ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°ã®èª­ã¿å–ã‚Š
é–¢æ•°ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§å®Ÿè¡Œã‚’é–‹å§‹ã™ã‚‹ã¨ã€å®Ÿè¡Œã¯`pending`çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚
å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¨ã€å®Ÿè¡ŒçŠ¶æ…‹ã‚’å–å¾—ã™ã‚‹APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®`requires_action`ã§ç¢ºèªã§ãã¾ã™ã€‚
ã“ã®ãƒ¢ãƒ‡ãƒ«ã¯ã€ä¸¦åˆ—é–¢æ•°å‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ã—ã¦ä¸€åº¦ã«å‘¼ã³å‡ºã™è¤‡æ•°ã®é–¢æ•°ã‚’æä¾›ã§ãã¾ã™ã€‚

èª¬æ˜ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¾‹ã‚’è¦‹ãŸæ®µéšã§ã¯ã•ã£ã±ã‚Šã§ã—ãŸãŒã€å®Ÿéš›ã«æ“ä½œã—ã¦ã¿ã¦ã‚ã‚‹ç¨‹åº¦é›°å›²æ°—ãŒã¤ã‹ã‚ã¾ã—ãŸã€‚

1. ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’ä½œæˆï¼ˆã“ã®æ™‚ç‚¹ã§ã¯ä½œæˆæ¸ˆã¿ï¼‰
2. ã‚¹ãƒ¬ãƒƒãƒ‰ã®é–‹å§‹
3. å®Ÿè¡Œã®é–‹å§‹ï¼ˆï¼é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ï¼‰
4. é–¢æ•°ãŒå®Ÿè¡Œä¸­ã¨ãªã‚Šã€è¿½åŠ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚å®Ÿè¡Œã¯é–¢æ•°ã®çµæœã‚’å¾…ã¤ãŸã‚ä¸€æ™‚åœæ­¢
5. é–¢æ•°ã«å¯¾ã—ã¦å‡ºåŠ›ã—ãŸã„çµæœã‚’æ¸¡ã™ã€‚
6. é–¢æ•°ãŒçµæœã‚’è¿”ã—ã€å®Ÿè¡ŒãŒå†é–‹ã•ã‚Œã€é–¢æ•°ã®çµæœã‚’ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®è¿”ç­”ã¨ã—ã¦å‡ºåŠ›ã€‚

ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¯ä½œæˆæ¸ˆã¿ãªã®ã§ã€ã‚¹ãƒ¬ãƒƒãƒ‰é–‹å§‹ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚

#### 2. ã‚¹ãƒ¬ãƒƒãƒ‰ã®é–‹å§‹ ã¨ 3.å®Ÿè¡Œã®é–‹å§‹
ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆã¨å®Ÿè¡Œã‚’é–‹å§‹ã¯åˆ¥ã€…ãªAPIã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¾ã™ãŒã€
ã‚¹ãƒ¬ãƒƒãƒ‰é–‹å§‹ã¨åŒæ™‚ã«å®Ÿè¡Œã‚’é–‹å§‹ã™ã‚‹APIã‚‚ã‚ã‚Šã¾ã™ã€‚

```shell
curl https://api.openai.com/v1/threads/runs \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "Content-Type: application/json" \
  -H "OpenAI-Beta: assistants=v1" \
  -d '{
      "assistant_id": "asst_DD8uOvrJ0PyNPU0AvM5x4jfj",
      "thread": {
        "messages": [
          {"role": "user", "content": "æ¨ªæµœå¸‚ã®å¤©æ°—ã¯ï¼Ÿæ¨ªæµœå¸‚ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã¯ï¼Ÿ"}
        ]
      }
    }'
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "id": "run_tyJrdU1WYzFAvNou640RJwaE",
  "object": "thread.run",
  "created_at": 1704513363,
  "assistant_id": "asst_DD8uOvrJ0PyNPU0AvM5x4jfj",
  "thread_id": "thread_BJx7VBxHG4uOU3e27Sax3jgM",
  "status": "queued",
  "started_at": null,
  "expires_at": 1704513963,
  "cancelled_at": null,
  "failed_at": null,
  "completed_at": null,
  "last_error": null,
  "model": "gpt-4-1106-preview",
  "instructions": "You are a weather bot. Use the provided functions to answer questions.",
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "getCurrentWeather",
        "description": "Get the weather in location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and state e.g. San Francisco, CA"
            },
            "unit": {
              "type": "string",
              "enum": [
                "c",
                "f"
              ]
            }
          },
          "required": [
            "location"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "getNickname",
        "description": "Get the nickname of a city",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and state e.g. San Francisco, CA"
            }
          },
          "required": [
            "location"
          ]
        }
      }
    }
  ],
  "file_ids": [],
  "metadata": {}
}
```

#### 4. å®Ÿè¡ŒçŠ¶æ…‹ã®ç¢ºèª
ã‚¹ãƒ¬ãƒƒãƒ‰ã¨å®Ÿè¡Œã®é–‹å§‹ã«ã‚ˆã£ã¦ã€ã‚¹ãƒ¬ãƒƒãƒ‰IDã¨å®Ÿè¡ŒIDãŒç™ºè¡Œã•ã‚Œã‚‹ã®ã§ã€ãã‚Œã‚’ç”¨ã„ã¦ç¢ºèªã—ã¾ã™ã€‚

```json
curl https://api.openai.com/v1/threads/thread_BJx7VBxHG4uOU3e27Sax3jgM/runs/run_tyJrdU1WYzFAvNou640RJwaE \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1"
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```
{
  "id": "run_scPYDkvkXs5rW4am7LbCHsrK",
  "object": "thread.run",
  "created_at": 1704514456,
  "assistant_id": "asst_DD8uOvrJ0PyNPU0AvM5x4jfj",
  "thread_id": "thread_L0vLoQnz0miavyGFZh6R1Sia",
  "status": "requires_action",
  "started_at": 1704514456,
  "expires_at": 1704515056,
  "cancelled_at": null,
  "failed_at": null,
  "completed_at": null,
  "required_action": {
    "type": "submit_tool_outputs",
    "submit_tool_outputs": {
      "tool_calls": [
        {
          "id": "call_SOMluLRjthL04pNVThCXMygM",
          "type": "function",
          "function": {
            "name": "getCurrentWeather",
            "arguments": "{\"location\": \"Yokohama, Japan\"}"
          }
        },
        {
          "id": "call_2QQlQJYhJBZCJhG4vX3u639B",
          "type": "function",
          "function": {
            "name": "getNickname",
            "arguments": "{\"location\": \"Yokohama, Japan\"}"
          }
        }
      ]
    }
  },
  "last_error": null,
  "model": "gpt-4-1106-preview",
  "instructions": "You are a weather bot. Use the provided functions to answer questions.",
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "getCurrentWeather",
        "description": "Get the weather in location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and state e.g. San Francisco, CA"
            },
            "unit": {
              "type": "string",
              "enum": [
                "c",
                "f"
              ]
            }
          },
          "required": [
            "location"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "getNickname",
        "description": "Get the nickname of a city",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and state e.g. San Francisco, CA"
            }
          },
          "required": [
            "location"
          ]
        }
      }
    }
  ],
  "file_ids": [],
  "metadata": {}
}
```

`required_action`ã®`submit_tool_outputs`ã«é–¢æ•°å‡ºåŠ›ã®é€ä¿¡ã‚’å¾…ã£ã¦ã„ã‚‹é–¢æ•°ãŒãƒªã‚¹ãƒˆåŒ–ã•ã‚Œã¾ã™ã€‚
`call_`ã§å§‹ã¾ã‚‹idãŒå¤§äº‹ã§ã€é–¢æ•°å‡ºåŠ›ã®é€ä¿¡æ™‚ã«å‡ºåŠ›å¯¾è±¡ã®é–¢æ•°ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚
``ãŒé–¢æ•°ã«æ¸¡ã•ã‚Œã‚‹å¼•æ•°ã‚’è¡¨ã—ã¦ãŠã‚Šã€ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãŒé€ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰è‡ªå‹•çš„ã«è¨­å®šã•ã‚Œã‚‹ã‚ˆã†ã§ã™ã€‚
æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã‹ã‚‰ä½¿ç”¨ã™ã¹ãé–¢æ•°ã¨å¼•æ•°ã¨ãªã‚‹æ¨ªæµœå¸‚ã‚’æŠœãå‡ºã—ã¦ã„ã¾ã™ã€‚
`Yokohama, Japan`ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰ã€GPTå†…ã§å¤‰æ›ã•ã‚Œã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

æ¨ªæµœå¸‚ã®å¤©æ°—ã¯ï¼Ÿã¨ã ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹ã¨ã€`getCurrentWeather`ã®é–¢æ•°ã ã‘ãŒå‘¼ã³å‡ºã•ã‚Œã€`getNickname`ã®é–¢æ•°ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚



### é–¢æ•°å‡ºåŠ›ã®é€ä¿¡
`submit_tool_outputs`APIã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§é–¢æ•°ãŒè¿”å´ã™ã‚‹å‡ºåŠ›ã‚’æŒ‡å®šã§ãã¾ã™ã€‚
`tool_call_id`ã«å…ˆã»ã©å®Ÿè¡ŒçŠ¶æ…‹ã®ç¢ºèªã§å¾—ãŸ`call_`ã§å§‹ã¾ã‚‹idã‚’è¨­å®šã—ã¾ã™ã€‚

```shell
curl https://api.openai.com/v1/threads/thread_L0vLoQnz0miavyGFZh6R1Sia/runs/run_scPYDkvkXs5rW4am7LbCHsrK/submit_tool_outputs \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1" \
  -d '{
    "tool_outputs": [{
      "tool_call_id": "call_SOMluLRjthL04pNVThCXMygM",
      "output": "{\"temperature\": \"22\", \"unit\": \"celsius\"}"
    }, {
      "tool_call_id": "call_2QQlQJYhJBZCJhG4vX3u639B",
      "output": "{\"nickname\": \"ã¯ã¾\"}"
    }]
  }'
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
:::details ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
{
  "id": "run_scPYDkvkXs5rW4am7LbCHsrK",
  "object": "thread.run",
  "created_at": 1704514456,
  "assistant_id": "asst_DD8uOvrJ0PyNPU0AvM5x4jfj",
  "thread_id": "thread_L0vLoQnz0miavyGFZh6R1Sia",
  "status": "queued",
  "started_at": 1704514456,
  "expires_at": 1704515056,
  "cancelled_at": null,
  "failed_at": null,
  "completed_at": null,
  "last_error": null,
  "model": "gpt-4-1106-preview",
  "instructions": "You are a weather bot. Use the provided functions to answer questions.",
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "getCurrentWeather",
        "description": "Get the weather in location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and state e.g. San Francisco, CA"
            },
            "unit": {
              "type": "string",
              "enum": [
                "c",
                "f"
              ]
            }
          },
          "required": [
            "location"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "getNickname",
        "description": "Get the nickname of a city",
        "parameters": {
          "type": "object",
          "properties": {
            "location": {
              "type": "string",
              "description": "The city and state e.g. San Francisco, CA"
            }
          },
          "required": [
            "location"
          ]
        }
      }
    }
  ],
  "file_ids": [],
  "metadata": {}
}
```
:::
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯å®Ÿè¡Œã®æƒ…å ±ã‚’è¿”ã™ã ã‘ãªã®ã§ã€ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã¦ã„ãªã„ã‹ãã‚‰ã„ã®ç¢ºèªã§è‰¯ã•ãã†ã§ã™ã€‚
ã¡ãªã¿ã«ã€é–¢æ•°å‡ºåŠ›ã®é€ä¿¡ã‚’APIã§é€ã‚‹ã®ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã†ã¨æœŸé™åˆ‡ã‚Œã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
å®Ÿè¡ŒçŠ¶æ…‹ã®ç¢ºèªãªã©ã—ãŸéš›ã®ã€`status`ãŒ`expired`ã®å ´åˆã¯æœŸé™åˆ‡ã‚Œãªã®ã§ã€ã‚‚ã†ä¸€åº¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚ŠãªãŠã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚


#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚„ã‚Šã¨ã‚Šã‚’ç¢ºèª
é–¢æ•°ã®çµæœã‚’é€ä¿¡ã—ãŸã“ã¨ã‚’è¸ã¾ãˆã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã©ã®ã‚ˆã†ã«å‡ºåŠ›ã•ã‚ŒãŸã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

```json
curl https://api.openai.com/v1/threads/thread_BJx7VBxHG4uOU3e27Sax3jgM/runs/run_tyJrdU1WYzFAvNou640RJwaE/messages \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "OpenAI-Beta: assistants=v1"
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```
{
  "object": "list",
  "data": [
    {
      "id": "msg_QSDCDInszGxtL4XdKlhO8wNR",
      "object": "thread.message",
      "created_at": 1704514594,
      "thread_id": "thread_L0vLoQnz0miavyGFZh6R1Sia",
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": {
            "value": "æ¨ªæµœå¸‚ã®ç¾åœ¨ã®å¤©æ°—ã¯22â„ƒã§ã™ã€‚æ¨ªæµœå¸‚ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã¯ã€Œã¯ã¾ã€ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚",
            "annotations": []
          }
        }
      ],
      "file_ids": [],
      "assistant_id": "asst_DD8uOvrJ0PyNPU0AvM5x4jfj",
      "run_id": "run_scPYDkvkXs5rW4am7LbCHsrK",
      "metadata": {}
    },
    {
      "id": "msg_8nbNH4gRjjiRdJyRJ1G7Fchi",
      "object": "thread.message",
      "created_at": 1704514456,
      "thread_id": "thread_L0vLoQnz0miavyGFZh6R1Sia",
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": {
            "value": "æ¨ªæµœå¸‚ã®å¤©æ°—ã¯ï¼Ÿæ¨ªæµœå¸‚ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã¯ï¼Ÿ",
            "annotations": []
          }
        }
      ],
      "file_ids": [],
      "assistant_id": null,
      "run_id": null,
      "metadata": {}
    }
  ],
  "first_id": "msg_QSDCDInszGxtL4XdKlhO8wNR",
  "last_id": "msg_8nbNH4gRjjiRdJyRJ1G7Fchi",
  "has_more": false
}
```

ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆãŒé–¢æ•°ã®çµæœã‚’ã‚‚ã¨ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”å´å‡ºæ¥ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã€‚
`æ¨ªæµœå¸‚ã®ç¾åœ¨ã®å¤©æ°—ã¯22â„ƒã§ã™ã€‚æ¨ªæµœå¸‚ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã¯ã€Œã¯ã¾ã€ã¨ã•ã‚Œã¦ã„ã¾ã™ã€‚`


## ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
`text/`ã®MIMEã‚¿ã‚¤ãƒ—ã®å ´åˆã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¯`utf-8`ã€`utf-16`ã€ã¾ãŸã¯`ascii`ã®ã„ãšã‚Œã‹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

| ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ | MIMEã‚¿ã‚¤ãƒ— | ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ | æ¤œç´¢æ©Ÿèƒ½ |
|-----------|----------|----------------|------|
| .c | text/x-c | âšªï¸ | âšªï¸ |
| .cpp | text/x-c++ | âšªï¸ | âšªï¸ |
| .csv | application/csv | âšªï¸ | |
| .docx | application/vnd.openxmlformats-officedocument.wordprocessingml.document| âšªï¸ | âšªï¸ |
| .html | text/html | âšªï¸ | âšªï¸ |
| .java | text/x-java | âšªï¸ | âšªï¸ |
| .json | application/json | âšªï¸ | âšªï¸ |
| .md | text/markdown | âšªï¸ | âšªï¸ |
| .pdf | application/pdf | âšªï¸ | âšªï¸ |
| .php | text/x-php | âšªï¸ | âšªï¸ |
| .pptx | application/vnd.openxmlformats-officedocument.presentationml.presentation | âšªï¸ | âšªï¸ |
| .py | text/x-python | âšªï¸ | âšªï¸ |
| .py | text/x-script.python | âšªï¸ | âšªï¸ |
| .rb | text/x-ruby | âšªï¸ | âšªï¸ |
| .tex | text/x-tex | âšªï¸ | âšªï¸ |
| .txt | text/plain | âšªï¸ | âšªï¸ |
| .css | text/css | âšªï¸ | |
| .jpeg | image/jpeg | âšªï¸ | |
| .jpg | image/jpeg | âšªï¸ | |
| .js | text/javascript | âšªï¸ | |
| .gif | image/gif | âšªï¸ | |
| .png | image/png | âšªï¸ | |
| .tar | application/x-tar | âšªï¸ | |
| .ts | application/typescript | âšªï¸ | |
| .xlsx | application/vnd.openxmlformats-officedocument.spreadsheetml.sheet | âšªï¸ | |
| .xml | application/xml or "text/xml" | âšªï¸ | |
| .zip | application/zip | âšªï¸ | |
