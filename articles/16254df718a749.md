---
title: "SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰"
emoji: "ğŸ’¬"
type: "tech"
topics:
  - "aws"
  - "go"
  - "cicd"
  - "sam"
  - "pipeline"
published: true
published_at: "2023-12-09 16:00"
publication_name: "rescuenow"
---


# ã¯ã˜ã‚ã«
æœ€è¿‘ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åŒ–ã—ãŸã‚¿ã‚¹ã‚¯ã®å®Ÿè£…ã§AWSã€€SAMã‚’ç”¨ã„ã¦æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚
å®Ÿè£…å„ªå…ˆã§é€²ã‚ã¦ã„ãŸãŸã‚ã€æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã§å‡Œã„ã§ãã¾ã—ãŸãŒã€
ã‚ã‚‹ç¨‹åº¦å®Ÿè£…ãŒè½ã¡ç€ã„ã¦ããŸã“ã¨ã‚‚ã‚ã‚Šã€CI/CDå‘¨ã‚Šã‚’å®Ÿè£…ã—ã‚ˆã†ã¨æ€ã£ãŸã¨ã“ã‚ã€
SAMã«CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’çŸ¥ã‚Šã€
ä½¿ã„å‹æ‰‹ã‚’è©¦ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

SAMã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥å‰ãƒ–ãƒ­ã‚°ã§æ›¸ã„ãŸã‚‚ã®ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
https://zenn.dev/kat/articles/2a230e980284be


# SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã§ãã‚‹ã“ã¨
- SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç”¨ã„ã‚‹ã“ã¨ã§é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒãã‚Œãã‚Œã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’åˆ†ã‘ã‚‹ï¼’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒç°¡å˜ã«ä½œæˆã§ãã¾ã™ã€‚
- ãƒ‡ãƒ—ãƒ­ã‚¤ã«å¿…è¦ãªãƒ­ãƒ¼ãƒ«ã‚„ãƒªã‚½ãƒ¼ã‚¹ãªã©ã¯å¯¾è©±å½¢å¼ã§æŒ‡å®šã™ã‚‹ã‹è‡ªå‹•ã§ä½œæˆã—ã¦ãã‚Œã‚‹ãŸã‚æ¨©é™ä¸è¶³ã«ã‚ˆã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—ã®æ‰‹é–“ã‚’æ¸›ã‚‰ã›ã¾ã™ã€‚

ä¸€è¨€ã§è¨€ã†ã¨ã€ä¸Šè¨˜ã®ã‚ˆã†ãªãƒ‡ãƒ—ãƒ­ã‚¤ã®æº–å‚™ä½œæ¥­ã¨CI/CDã‚’è¡Œã†ãŸã‚ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯¾è©±å¼ã«ä½œæˆã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

**SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå¯¾å¿œã—ã¦ã„ã‚‹CI/CDã‚µãƒ¼ãƒ“ã‚¹**
- AWS CodePipeline
- Jenkins
- GitLab CI/CD
- GitHub Actions
- Bitbucket Pipelines

ä¾‹ãˆã°ã€AWS CodePipelineã§ã‚ã‚Œã°ã€CodePipeline ã‚„ EventBridgeãƒ«ãƒ¼ãƒ«ãªã©ã®SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
GitLabã§ã‚ã‚Œã°`.gitlab-ci.yml`ã€
GitHubã§ã‚ã‚Œã°`.github/workflows`ã«`pipeline.yaml`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

â€»ä»Šå›è©¦ã—ã¦ã¿ã‚‹ã¾ã§ã¯ã€SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è‡ªä½“ãŒãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç”Ÿæˆã‹ã‚‰å®Ÿè¡Œã¾ã§ã™ã¹ã¦ã‚’è¡Œã£ã¦ãã‚Œã‚‹ã‚‚ã®ã‹ã¨å‹˜é•ã„ã—ã¦ãŠã‚Šã¾ã—ãŸãŒã€å®Ÿéš›ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯å„ç¨®CI/CDã‚µãƒ¼ãƒ“ã‚¹ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ãã®ãŸã‚ã€ã™ã§ã«SAMã‚„Cloudformationsã§æ§‹ç¯‰ã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒãŒã‚ã‚‹å ´åˆã¯ã‚ãˆã¦SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ç”¨ã„ãšã«æµç”¨ã™ã‚‹ã®ã‚‚è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚


# CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ç”¨ã®SAMã‚³ãƒãƒ³ãƒ‰

ä»¥ä¸‹ï¼’ã¤ã®ã‚³ãƒãƒ³ãƒ‰ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚
- `sam pipeline bootstrap`
ã€€ã€€CI/CDã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«å¿…è¦ãªAWSãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
- `sam pipeline init`
ã€€ã€€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

```
sam pipeline --help
Usage: sam pipeline [OPTIONS] COMMAND [ARGS]...

  Manage the continuous delivery of the application

Options:
  -h, --help  Show this message and exit.

Commands:
  bootstrap  Generates the required AWS resources to connect your CI/CD system.
  init       Generates a CI/CD pipeline configuration file.
```


# `bootstrap`ã‚³ãƒãƒ³ãƒ‰ã§CI/CDã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ

`sam pipeline bootstrap`ã§é–‹å§‹ã—ã¾ã™ã€‚

```
sam pipeline bootstrap

sam pipeline bootstrap generates the required AWS infrastructure resources to connect
to your CI/CD system. This step must be run for each deployment stage in your pipeline,
prior to running the sam pipeline init command.

We will ask for [1] stage definition, [2] account details, and
[3] references to existing resources in order to bootstrap these pipeline resources.
```
å¤§ãã3ã¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
1. ã‚¹ãƒ†ãƒ¼ã‚¸å®šç¾©ï¼ˆé–‹ç™ºã€æ¤œè¨¼ã€æœ¬ç•ªãªã©ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å˜ä½ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ã¨ç§°ã—ã¦ã„ã¾ã™ã€‚ï¼‰
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè©³ç´°ï¼ˆã“ã®
3. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã®æŒ‡å®šã‚„ä½œæˆ

```
[1] Stage definition
Enter a configuration name for this stage. This will be referenced later when you use the sam pipeline init command:
Stage configuration name: dev
```
ã‚¹ãƒ†ãƒ¼ã‚¸ã®åç§°ã‚’è¨­å®šã—ã¾ã™ã€‚`pipeline init`ã®éš›ã«æŒ‡å®šã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
ã©ã®ç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‹ã€ç­‰ã§ã‚ã‹ã‚Šã‚„ã™ã„åå‰ã«ã™ã‚‹ã®ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ã€é–‹ç™ºç”¨ã¨ã—ã¦`dev`ã¨ã—ã¾ã™ã€‚


```
[2] Account details
The following AWS credential sources are available to use.
To know more about configuration AWS credentials, visit the link below:
https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html                
        1 - Environment variables (not available)
        2 - default (named profile)
	ã€œ ä¸­ç•¥ ã€œ
        9 - sdtoki (named profile)
        10 - sam (named profile)
        q - Quit and configure AWS credentials
Select a credential source to associate with this stage: 10
Associated account {AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆID} with configuration dev.
```
èªè¨¼æƒ…å ±ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã®profileæƒ…å ±ã‹ã‚‰èª­ã¿å–ã£ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚
ã“ã®å¾Œä½œæˆã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ä½œæˆãŒå¯èƒ½ãªæ¨©é™ã‚’æŒã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
é©åˆ‡ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```
Enter the region in which you want these resources to be created [ap-northeast-1]: 
```
ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€‚

```
Select a user permissions provider:
        1 - IAM (default)
        2 - OpenID Connect (OIDC)
Choice (1, 2): 2
```
èªè¨¼æ–¹æ³•ã‚’é¸æŠã—ã¾ã™ã€‚
IAMã‹OIDCãŒé¸ã¹ã¾ã™ã€‚
OIDCã«ã—ã¾ã™ã€‚

```
Select an OIDC provider:
        1 - GitHub Actions
        2 - GitLab
        3 - Bitbucket
Choice (1, 2, 3): 1
```
OIDCã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’é¸æŠã—ã¾ã™ã€‚
ä»Šå›ã¯GitHub Actionsã«ã—ãŸã„ã®ã§ã€€1 ã‚’é¸æŠ

```
Enter the URL of the OIDC provider [https://token.actions.githubusercontent.com]: 
```
OIDCãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®URLã‚’æŒ‡å®šã—ã¾ã™ã€‚
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒã™ã§ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãã®ã¾ã¾ã‚¨ãƒ³ã‚¿ãƒ¼ã§è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚

```
Enter the OIDC client ID (sometimes called audience) [sts.amazonaws.com]: 
```
OIDCã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®æŒ‡å®šã§ã™ã€‚
ã“ã¡ã‚‰ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ã€‚

```
Enter the GitHub organization that the code repository belongs to. If there is no organization enter your username instead: KaT0819
```
Githubã®çµ„ç¹”åã‹ãƒ¦ãƒ¼ã‚¶åã‚’æŒ‡å®šã—ã¾ã™ã€‚

```
Enter GitHub repository name: aws-step-function-sample
```
ãƒªãƒã‚¸ãƒˆãƒªåã‚’æŒ‡å®šã—ã¾ã™ã€‚

```
Enter the name of the branch that deployments will occur from [main]: develop
```
ã“ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Ÿè¡Œã•ã‚Œã‚‹å¯¾è±¡ã¨ãªã‚‹ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã—ã¾ã™ã€‚


```
[3] Reference application build resources
Enter the pipeline execution role ARN if you have previously created one, or we will create one for you []: 
Enter the CloudFormation execution role ARN if you have previously created one, or we will create one for you []: 
Please enter the artifact bucket ARN for your Lambda function. If you do not have a bucket, we will create one for you []: 
Does your application contain any IMAGE type Lambda functions? [y/N]:  
```
ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éš›ã«å¿…è¦ã¨ãªã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚
æŒ‡å®šã—ãŸã„å ´åˆã¯å…¥åŠ›ã—ã¾ã™ã€‚ä½•ã‚‚å…¥åŠ›ã›ãšã‚¨ãƒ³ã‚¿ãƒ¼ã§è‡ªå‹•ä½œæˆã—ã¦ãã‚Œã¾ã™ã€‚
- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ­ãƒ¼ãƒ«ã®ARN
- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚ã®CloudFormationã®å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã®ARN
- Lambdaé–¢æ•°ã®ãŸã‚ã®ãƒã‚±ãƒƒãƒˆã®ARN

```
[4] Summary
Below is the summary of the answers:
        1 - Account: {AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆID}
        2 - Stage configuration name: dev
        3 - Region: ap-northeast-1
        4 - OIDC identity provider URL: https://token.actions.githubusercontent.com
        5 - OIDC client ID: sts.amazonaws.com
        6 - GitHub organization: KaT0819
        7 - GitHub repository: aws-step-function-sample
        8 - Deployment branch:  develop
        9 - Pipeline execution role: [to be created]
        10 - CloudFormation execution role: [to be created]
        11 - Artifacts bucket: [to be created]
        12 - ECR image repository: [skipped]
Press enter to confirm the values above, or select an item to edit the value: 
```
å…¥åŠ›ã—ãŸå†…å®¹ã®ç¢ºèªã§ã™ã€‚
å•é¡Œãªã‘ã‚Œã°ã‚¨ãƒ³ã‚¿ãƒ¼ã€ä¿®æ­£ã—ãŸã„ç®‡æ‰€ãŒã‚ã‚Œã°ä¿®æ­£ã—ãŸã„é …ç›®ã®æ•°å€¤ã‚’å…¥ã‚Œã¦ã‚¨ãƒ³ã‚¿ãƒ¼

```
This will create the following required resources for the 'dev' configuration: 
        - IAM OIDC Identity Provider
        - Pipeline execution role
        - CloudFormation execution role
        - Artifact bucket
Should we proceed with the creation? [y/N]: y
        Creating the required resources...
```
æœ€çµ‚ç¢ºèªã§ã™ã€‚ã“ã“ã§æœ€å¾Œã®å®Ÿè¡Œç¢ºèªã§ã™ã€‚
`y` ã§å®Ÿè¡Œ `n` ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯èƒ½ã§ã™ã€‚
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãªã®ã§ã€ã¾ã¡ãŒã£ã¦ã‚¨ãƒ³ã‚¿ãƒ¼æŠ¼ã—ã¦ã—ã¾ã†ã¨æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã«ãªã‚Šã¾ã™ã€‚ã€‚

å®Ÿè¡Œé–‹å§‹ã™ã‚‹ã¨CloudformationãŒå®Ÿè¡Œã•ã‚Œã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/d500a8d61527-20231126.png)

SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ï¼’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãŸã‚ã€åŒæ§˜ã®æ‰‹é †ã§ã‚‚ã†ä¸€ã¤ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚
ä»Šåº¦ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯`prd`ã¨ã—ã¾ã™ã€‚
ä»–ã¯ä¸€ç·’ãªã®ã§å†…å®¹ã¯å‰²æ„›ã—ã¾ã™ã€‚


# `init`ã‚³ãƒãƒ³ãƒ‰ã§CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
`sam pipeline init`ã§é–‹å§‹ã—ã¾ã™ã€‚

```
sam pipeline init

sam pipeline init generates a pipeline configuration file that your CI/CD system
can use to deploy serverless applications using AWS SAM.
We will guide you through the process to bootstrap resources for each stage,
then walk through the details necessary for creating the pipeline config file.

Please ensure you are in the root folder of your SAM application before you begin.

Select a pipeline template to get started:
        1 - AWS Quick Start Pipeline Templates
        2 - Custom Pipeline Template Location
Choice: 1
```
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¾ã™ã€‚
1ã‚’é¸æŠã—ã¾ã™ã€‚

```
Cloning from https://github.com/aws/aws-sam-cli-pipeline-init-templates.git (process may take a moment)                                         
Select CI/CD system
        1 - Jenkins
        2 - GitLab CI/CD
        3 - GitHub Actions
        4 - Bitbucket Pipelines
        5 - AWS CodePipeline
Choice: 3
```
CI/CDã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠã—ã¾ã™ã€‚
Githubãªã®ã§3ã‚’é¸æŠã—ã¾ã™ã€‚

```
You are using the 2-stage pipeline template.
 _________    _________ 
|         |  |         |
| Stage 1 |->| Stage 2 |
|_________|  |_________|

Checking for existing stages...

2 stage(s) were detected, matching the template requirements. If these are incorrect, delete .aws-sam/pipeline/pipelineconfig.toml and rerun

This template configures a pipeline that deploys a serverless application to a testing and a production stage.
```
ï¼’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚
å…ˆã»ã©bootstrapã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã—ãŸã‚¹ãƒ†ãƒ¼ã‚¸ã®å­˜åœ¨ã‚’ç¢ºèªã—ã€ã“ã®å…ˆã®è¨­å®šã«é€²ã¿ã¾ã™ã€‚
1ã¤ã—ã‹ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¦ã„ãªã„å ´åˆã¯ã“ã“ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

```
What is the git branch used for production deployments? [main]:        
```
æœ¬ç•ªç’°å¢ƒã®ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã—ã¾ã™ã€‚mainãªã®ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€‚

```
What is the template file path? [template.yaml]: 
```
SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚ã“ã¡ã‚‰ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€‚

```
We use the stage configuration name to automatically retrieve the bootstrapped resources created when you ran `sam pipeline bootstrap`.

Here are the stage configuration names detected in .aws-sam/pipeline/pipelineconfig.toml:
        1 - dev
        2 - prd
Select an index or enter the stage 1's configuration name (as provided during the bootstrapping): 1
```
1ã¤ç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é¸æŠã—ã¾ã™ã€‚æœ€åˆã¯é–‹ç™ºç”¨ã«ã—ãŸã„ã®ã§ã€1ã‚’é¸æŠ


```
What is the sam application stack name for stage 1? [sam-app]: sam-step-function-sample-dev
```
SAMãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ã‚¹ã‚¿ãƒƒã‚¯åã‚’æŒ‡å®šã—ã¾ã™ã€‚ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã«åå‰ã‚’åˆ†ã‘ã¦ãŠãã®ãŒè‰¯ã•ãã†ã€‚

```
Stage 1 configured successfully, configuring stage 2.

Here are the stage configuration names detected in .aws-sam/pipeline/pipelineconfig.toml:
        1 - dev
        2 - prd
Select an index or enter the stage 2's configuration name (as provided during the bootstrapping): 2
```
æ¬¡ã«2ã¤ç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’é¸æŠã—ã¾ã™ã€‚æœ¬ç•ªç”¨ãªã®ã§ã€ï¼’ã‚’é¸æŠ


```
What is the sam application stack name for stage 2? [sam-app]: sam-step-function-sample-prd
Stage 2 configured successfully.
```
SAMãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®ã‚¹ã‚¿ãƒƒã‚¯åã‚’æŒ‡å®šã—ã¾ã™ã€‚


```
SUMMARY
We will generate a pipeline config file based on the following information:
        Select a user permissions provider.: OpenID Connect (OIDC)
        What is the git branch used for production deployments?: main
        What is the template file path?: template.yaml
        Select an index or enter the stage 1's configuration name (as provided during the bootstrapping): 1
        What is the sam application stack name for stage 1?: sam-step-function-sample-dev
        What is the pipeline execution role ARN for stage 1?: arn:aws:iam::ã€œã€œ
        What is the CloudFormation execution role ARN for stage 1?: arn:aws:iam::ã€œã€œ
        What is the S3 bucket name for artifacts for stage 1?: aws-sam-cli-managed-dev-pipeline-r-artifactsbucket-dwojsqvhcloc
        What is the ECR repository URI for stage 1?: 
        What is the AWS region for stage 1?: ap-northeast-1
        Select an index or enter the stage 2's configuration name (as provided during the bootstrapping): 2
        What is the sam application stack name for stage 2?: sam-step-function-sample-prd
        What is the pipeline execution role ARN for stage 2?: arn:aws:iam::ã€œã€œ
        What is the CloudFormation execution role ARN for stage 2?: arn:aws:iam::ã€œã€œ
        What is the S3 bucket name for artifacts for stage 2?: aws-sam-cli-managed-prd-pipeline-r-artifactsbucket-vw7fgewbnmwl
        What is the ECR repository URI for stage 2?: 
        What is the AWS region for stage 2?: ap-northeast-1
Successfully created the pipeline configuration file(s):
        - .github/workflows/pipeline.yaml
```
ã‚µãƒãƒªãŒè¡¨ç¤ºã•ã‚Œã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
ã“ã“ã§ã¯æœ€çµ‚ç¢ºèªã¯ãªãä½œæˆã¾ã§é€²ã¿ã¾ã™ã€‚

# ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
```
â”œâ”€â”€ .aws-sam
â”‚   â”œâ”€â”€ build
â”‚   â”œâ”€â”€ build.toml
â”‚   â””â”€â”€ pipeline
â”‚       â””â”€â”€ pipelineconfig.toml
â”œâ”€â”€ .github
â”‚   â””â”€â”€ workflows
â”‚       â””â”€â”€ pipeline.yaml
â”œâ”€â”€ samconfig.toml
â””â”€â”€ template.yaml
```
é–¢é€£ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿æŠœç²‹
â€»samconfig.toml ã¯ã“ã®å¾Œæ¶ˆãˆã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã®ã§ä¸è¦ã§ã™ã€‚

### `.aws-sam/pipeline/pipelineconfig.toml`
`bootstrap`ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«ä½œæˆã•ã‚Œã¾ã™ã€‚
ä½œæˆã—ãŸARNãªã©ãŒä¿æŒã•ã‚Œã¦ã„ã¾ã™ã€‚

```
version = 0.1
[default.pipeline_bootstrap.parameters]
oidc_provider_url = "https://token.actions.githubusercontent.com"
oidc_client_id = "sts.amazonaws.com"
github_org = "KaT0819"
github_repo = "aws-step-function-sample"
deployment_branch = "develop"
oidc_provider = "github-actions"
permissions_provider = "OpenID Connect (OIDC)"

[dev.pipeline_bootstrap.parameters]
pipeline_execution_role = "arn:aws:iam::ã€œã€œ"
cloudformation_execution_role = "arn:aws:iam::ã€œã€œ"
artifacts_bucket = "aws-sam-cli-managed-dev-pipeline-r-artifactsbucket-dwojsqvhcloc"
image_repository = ""
region = "ap-northeast-1"
```


### `.github/workflows/pipeline.yaml`
`init`ã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

:::details pipeline.toml
```yaml
name: Pipeline

on:
  push:
    branches:
      - 'main'
      - 'feature**'
  delete:
    branches:
      - 'feature**'

env:
  SAM_TEMPLATE: template.yaml
  TESTING_STACK_NAME: sam-step-function-sample-dev
  TESTING_PIPELINE_EXECUTION_ROLE: arn:aws:iam::ã€œã€œ
  TESTING_CLOUDFORMATION_EXECUTION_ROLE: arn:aws:iam::ã€œã€œ
  TESTING_ARTIFACTS_BUCKET: aws-sam-cli-managed-dev-pipeline-r-artifactsbucket-dwojsqvhcloc
  # If there are functions with "Image" PackageType in your template,
  # uncomment the line below and add "--image-repository ${TESTING_IMAGE_REPOSITORY}" to
  # testing "sam package" and "sam deploy" commands.
  # TESTING_IMAGE_REPOSITORY = '0123456789.dkr.ecr.region.amazonaws.com/repository-name'
  TESTING_REGION: ap-northeast-1
  PROD_STACK_NAME: sam-step-function-sample-prd
  PROD_PIPELINE_EXECUTION_ROLE: arn:aws:iam::ã€œã€œ
  PROD_CLOUDFORMATION_EXECUTION_ROLE: arn:aws:iam::ã€œã€œ
  PROD_ARTIFACTS_BUCKET: aws-sam-cli-managed-prd-pipeline-r-artifactsbucket-vw7fgewbnmwl
  # If there are functions with "Image" PackageType in your template,
  # uncomment the line below and add "--image-repository ${PROD_IMAGE_REPOSITORY}" to
  # prod "sam package" and "sam deploy" commands.
  # PROD_IMAGE_REPOSITORY = '0123456789.dkr.ecr.region.amazonaws.com/repository-name'
  PROD_REGION: ap-northeast-1

permissions:
  id-token: write
  contents: read
jobs:
  test:
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: |
          # trigger the tests here

  delete-feature:
    if: startsWith(github.event.ref, 'feature') && github.event_name == 'delete'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: aws-actions/setup-sam@v2
        with:
          use-installer: true

      - name: Assume the testing pipeline user role
        uses: aws-actions/configure-aws-credentials@v1-node16
        with:
          aws-region: ${{ env.TESTING_REGION }}
          role-to-assume: ${{ env.TESTING_PIPELINE_EXECUTION_ROLE }}
          role-session-name: testing-packaging
          role-duration-seconds: 3600
          role-skip-session-tagging: true

      - name: Delete feature branch stack
        env:
          FEATURE_BRANCH_NAME: ${{ github.event.ref }}
        run: |
          sam delete \
            --stack-name $(echo ${FEATURE_BRANCH_NAME##*/} | tr -cd '[a-zA-Z0-9-]') \
            --region ${TESTING_REGION} \
            --no-prompts

  build-and-deploy-feature:
    # this stage is triggered only for feature branches (feature*),
    # which will build the stack and deploy to a stack named with branch name.
    # https://github.com/actions/setup-python
    # https://github.com/aws-actions/configure-aws-credentials#notice-node12-deprecation-warning
    if: startsWith(github.ref, 'refs/heads/feature')
    needs: [test]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: aws-actions/setup-sam@v2
        with:
          use-installer: true
      - run: sam build --template ${SAM_TEMPLATE} --use-container

      - name: Assume the testing pipeline user role
        uses: aws-actions/configure-aws-credentials@v1-node16
        with:
          aws-region: ${{ env.TESTING_REGION }}
          role-to-assume: ${{ env.TESTING_PIPELINE_EXECUTION_ROLE }}
          role-session-name: feature-deployment
          role-duration-seconds: 3600
          role-skip-session-tagging: true

      - name: Deploy to feature stack in the testing account
        shell: bash
        run: |
          sam deploy --stack-name $(echo ${GITHUB_REF##*/} | tr -cd '[a-zA-Z0-9-]') \
            --capabilities CAPABILITY_IAM \
            --region ${TESTING_REGION} \
            --s3-bucket ${TESTING_ARTIFACTS_BUCKET} \
            --no-fail-on-empty-changeset \
            --role-arn ${TESTING_CLOUDFORMATION_EXECUTION_ROLE}

  build-and-package:
    if: github.ref == 'refs/heads/main'
    needs: [test]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: aws-actions/setup-sam@v2
        with:
          use-installer: true

      - name: Build resources
        run: sam build --template ${SAM_TEMPLATE} --use-container

      - name: Assume the testing pipeline user role
        uses: aws-actions/configure-aws-credentials@v1-node16
        with:
          aws-region: ${{ env.TESTING_REGION }}
          role-to-assume: ${{ env.TESTING_PIPELINE_EXECUTION_ROLE }}
          role-session-name: testing-packaging
          role-duration-seconds: 3600
          role-skip-session-tagging: true

      - name: Upload artifacts to testing artifact buckets
        run: |
          sam package \
            --s3-bucket ${TESTING_ARTIFACTS_BUCKET} \
            --region ${TESTING_REGION} \
            --output-template-file packaged-testing.yaml

      - uses: actions/upload-artifact@v3
        with:
          name: packaged-testing.yaml
          path: packaged-testing.yaml

      - name: Assume the prod pipeline user role
        uses: aws-actions/configure-aws-credentials@v1-node16
        with:
          aws-region: ${{ env.PROD_REGION }}
          role-to-assume: ${{ env.PROD_PIPELINE_EXECUTION_ROLE }}
          role-session-name: prod-packaging
          role-duration-seconds: 3600
          role-skip-session-tagging: true

      - name: Upload artifacts to production artifact buckets
        run: |
          sam package \
            --s3-bucket ${PROD_ARTIFACTS_BUCKET} \
            --region ${PROD_REGION} \
            --output-template-file packaged-prod.yaml

      - uses: actions/upload-artifact@v3
        with:
          name: packaged-prod.yaml
          path: packaged-prod.yaml

  deploy-testing:
    if: github.ref == 'refs/heads/main'
    needs: [build-and-package]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: aws-actions/setup-sam@v2
        with:
          use-installer: true
      - uses: actions/download-artifact@v3
        with:
          name: packaged-testing.yaml

      - name: Assume the testing pipeline user role
        uses: aws-actions/configure-aws-credentials@v1-node16
        with:
          aws-region: ${{ env.TESTING_REGION }}
          role-to-assume: ${{ env.TESTING_PIPELINE_EXECUTION_ROLE }}
          role-session-name: testing-deployment
          role-duration-seconds: 3600
          role-skip-session-tagging: true

      - name: Deploy to testing account
        run: |
          sam deploy --stack-name ${TESTING_STACK_NAME} \
            --template packaged-testing.yaml \
            --capabilities CAPABILITY_IAM \
            --region ${TESTING_REGION} \
            --s3-bucket ${TESTING_ARTIFACTS_BUCKET} \
            --no-fail-on-empty-changeset \
            --role-arn ${TESTING_CLOUDFORMATION_EXECUTION_ROLE}

  integration-test:
    if: github.ref == 'refs/heads/main'
    needs: [deploy-testing]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: |
          # trigger the integration tests here

  deploy-prod:
    if: github.ref == 'refs/heads/main'
    needs: [integration-test]
    runs-on: ubuntu-latest
    # Configure GitHub Action Environment to have a manual approval step before deployment to production
    # https://docs.github.com/en/actions/reference/environments
    # environment: <configured-environment>
    steps:
      - uses: actions/checkout@v3
      - uses: aws-actions/setup-sam@v2
        with:
          use-installer: true
      - uses: actions/download-artifact@v3
        with:
          name: packaged-prod.yaml

      - name: Assume the prod pipeline user role
        uses: aws-actions/configure-aws-credentials@v1-node16
        with:
          aws-region: ${{ env.PROD_REGION }}
          role-to-assume: ${{ env.PROD_PIPELINE_EXECUTION_ROLE }}
          role-session-name: prod-deployment
          role-duration-seconds: 3600
          role-skip-session-tagging: true

      - name: Deploy to production account
        run: |
          sam deploy --stack-name ${PROD_STACK_NAME} \
            --template packaged-prod.yaml \
            --capabilities CAPABILITY_IAM \
            --region ${PROD_REGION} \
            --s3-bucket ${PROD_ARTIFACTS_BUCKET} \
            --no-fail-on-empty-changeset \
            --role-arn ${PROD_CLOUDFORMATION_EXECUTION_ROLE}
```
:::

ä½œæˆã•ã‚ŒãŸ`pipeline.yaml`å†…å®¹ã‚’ã–ã£ãã‚Šç¢ºèªã—ã¾ã™ã€‚

### ãƒˆãƒªã‚¬ãƒ¼å¯¾è±¡
- `main`ãƒ–ãƒ©ãƒ³ãƒã®ãƒ—ãƒƒã‚·ãƒ¥
- `feature`ã§å§‹ã¾ã‚‹ãƒ–ãƒ©ãƒ³ãƒã®ãƒ—ãƒƒã‚·ãƒ¥
- `feature`ã§å§‹ã¾ã‚‹ãƒ–ãƒ©ãƒ³ãƒã®å‰Šé™¤

`develop`ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã—ãŸã¤ã‚‚ã‚Šã§ã—ãŸãŒã€ãªãœã‹`feature**`ã«ãªã£ã¦ã—ã¾ã£ã¦ã„ã¾ã—ãŸã€‚
ãƒ†ã‚¹ãƒˆç”¨ã¨æœ¬ç•ªç”¨ã§ç’°å¢ƒå¤‰æ•°ãŒãã‚Œãã‚Œå®šç¾©ã•ã‚Œã¦ãŠã‚Šã€
ã‚¹ãƒ†ãƒ¼ã‚¸ï¼‘ãŒãƒ†ã‚¹ãƒˆç”¨ã€ã‚¹ãƒ†ãƒ¼ã‚¸ï¼’ãŒæœ¬ç•ªç”¨ã¨ãªã£ã¦ã„ã¾ã™ã€‚

### å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚¸ãƒ§ãƒ–ã®ç¢ºèª
ä¾¿å®œä¸Šã€`feature**`ã‚’ãƒ†ã‚¹ãƒˆç”¨ãƒ–ãƒ©ãƒ³ãƒã€`main`ã‚’æœ¬ç•ªç”¨ãƒ–ãƒ©ãƒ³ãƒã¨è¡¨ç¾ã—ã¾ã™ã€‚

- `test`: ãƒ†ã‚¹ãƒˆç”¨ã€æœ¬ç•ªç”¨ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸå ´åˆã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
- `delete-feature`: ãƒ†ã‚¹ãƒˆç”¨ãƒ–ãƒ©ãƒ³ãƒãŒå‰Šé™¤ã•ã‚ŒãŸå ´åˆã«ã€é–¢é€£ã™ã‚‹ã‚¹ã‚¿ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã€‚`sam delete`ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
- `build-and-deploy-feature`:
ãƒ†ã‚¹ãƒˆç”¨ãƒ–ãƒ©ãƒ³ãƒãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã€`test`ã‚¸ãƒ§ãƒ–ãŒå®Œäº†ã—ãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ãƒ“ãƒ«ãƒ‰ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚
1. `sam build`ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
2. `sam deploy`ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

- `build-and-package`:
æœ¬ç•ªç”¨ãƒ–ãƒ©ãƒ³ãƒãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã€`test`ã‚¸ãƒ§ãƒ–ãŒå®Œäº†ã—ãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
1. `sam build`ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
2. ãƒ†ã‚¹ãƒˆç”¨ã®ãƒã‚±ãƒƒãƒˆã«ãƒ“ãƒ«ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
3. æœ¬ç•ªç”¨ã®ãƒã‚±ãƒƒãƒˆã«ãƒ“ãƒ«ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

- `deploy-testing`:
æœ¬ç•ªç”¨ãƒ–ãƒ©ãƒ³ãƒãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã€`build-and-package`ã‚¸ãƒ§ãƒ–ãŒå®Œäº†ã—ãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ãƒ†ã‚¹ãƒˆç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

- `integration-test`:
æœ¬ç•ªç”¨ãƒ–ãƒ©ãƒ³ãƒãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã€`deploy-testing`ã‚¸ãƒ§ãƒ–ãŒå®Œäº†ã—ãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

- `deploy-prod`:
æœ¬ç•ªç”¨ãƒ–ãƒ©ãƒ³ãƒãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã€`integration-test`ã‚¸ãƒ§ãƒ–ãŒå®Œäº†ã—ãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚


# ARNãªã©ã‚’GitHubã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆåŒ–
yamlå†…ã§ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ãŒã€ARNã®åå‰ãªã©ãŒãƒ™ã‚¿æ›¸ãã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€
ãã‚Œã‚‰ã®æƒ…å ±ã‚’GitHubã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ä¿å­˜ã—ã¦ã€ãã®å€¤ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

ãƒªãƒã‚¸ãƒˆãƒªã‚’é–‹ãã€Settingsã€€ï¼ Secrets and variables ã® Actions ã‚’é–‹ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/2c11bf243c0e-20231126.png)
ã€ŒRepository secretsã€ã®ã€ŒNew repositodyã€€secretã€ã§è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ae1575ef7054-20231126.png)
è¿½åŠ ã—ã¾ã—ãŸã€‚

yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå‚ç…§ã«æ›¸ãæ›ãˆã¾ã™ã€‚
ä»¥ä¸‹æŠœç²‹
```yaml
env:
  SAM_TEMPLATE: template.yaml
  TESTING_STACK_NAME: ${{ secrets.TESTING_STACK_NAME }}
  TESTING_PIPELINE_EXECUTION_ROLE: ${{ secrets.TESTING_PIPELINE_EXECUTION_ROLE }}
  TESTING_CLOUDFORMATION_EXECUTION_ROLE: ${{ secrets.TESTING_CLOUDFORMATION_EXECUTION_ROLE }}
  TESTING_ARTIFACTS_BUCKET: ${{ secrets.TESTING_ARTIFACTS_BUCKET }}
  TESTING_REGION: ap-northeast-1
  PROD_STACK_NAME: ${{ secrets.PROD_STACK_NAME }}
  PROD_PIPELINE_EXECUTION_ROLE: ${{ secrets.PROD_PIPELINE_EXECUTION_ROLE }}
  PROD_CLOUDFORMATION_EXECUTION_ROLE: ${{ secrets.PROD_CLOUDFORMATION_EXECUTION_ROLE }}
  PROD_ARTIFACTS_BUCKET: ${{ secrets.PROD_ARTIFACTS_BUCKET }}
  PROD_REGION: ap-northeast-1
```


# ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª
yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚
ãƒ–ãƒ©ãƒ³ãƒåã¯`feature/sam-pipeline`ã¨ã—ã¾ã—ãŸã€‚

## GitHub Actionsã®ã‚¤ãƒ¡ãƒ¼ã‚¸
![](https://storage.googleapis.com/zenn-user-upload/7bc39bb94439-20231127.png)

# â€»ä¸€ç™ºã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ããªã‹ã£ãŸã®ã§å¯¾å‡¦
ã‚€ã—ã‚ã“ã¡ã‚‰ã®è§£æ¶ˆã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚ã€‚

## `pipeline.yamlã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªéšå±¤é•ã„`
è¤‡æ•°ã®SAMã‚’1ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã¦ã„ã‚‹æƒ³å®šã§è©¦ã—ã¦ã„ãŸã®ã§ã€
SAMã®ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«SAMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é…ç½®ã—ã¦ã„ãªã„ã“ã¨ã‹ã‚‰ã€
ä½œæˆã•ã‚Œã‚‹yamlãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹ã«ä½œæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚
`pipeline.yaml`ã®å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«`working-directory`ã‚’æŒ‡å®šã—ã¦å‚ç…§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½ç½®ã‚’èª¿æ•´ã—ã¦è§£æ±º

## Goã®ãƒ“ãƒ«ãƒ‰ã§ã‚¨ãƒ©ãƒ¼
```
      - name: Build resources
        run: sam build --template ${SAM_TEMPLATE} --use-container
```

**ã‚¨ãƒ©ãƒ¼å†…å®¹**
```
Error: GoModulesBuilder:Resolver - Path resolution for runtime: provided of binary: go was not successful
```
`sam build`ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

â†’ã€€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚‚è©¦ã—ã¦ã¿ã¾ã—ãŸãŒã€`--use-container`ã‚’æŒ‡å®šã—ãŸã‚³ãƒ³ãƒ†ãƒŠã§ã®ãƒ“ãƒ«ãƒ‰ãŒã†ã¾ãè¡Œã‹ãªã„ã‚ˆã†ã§ã™ã€‚
Lambdaã®Runtimeå•é¡Œãªã®ã‹ã€ã„ã‚ã„ã‚è©¦ã—ã¾ã—ãŸãŒã†ã¾ãè¡Œãã¾ã›ã‚“ã€‚
AWS CLIã®æœ€æ–°åŒ–ã€SAM CLIã®æœ€æ–°åŒ–ã‚‚ã—ã¦ã¿ã¾ã—ãŸãŒçµæœã¯å¤‰ã‚ã‚‰ãšã€‚
ã‚³ãƒ³ãƒ†ãƒŠãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã†ã¾ãã„ã‹ãªã„ã®ã§`--use-container`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¤–ã—ã¦è§£æ±º

## Assumeãƒ­ãƒ¼ãƒ«æ¨©é™ãŒä¸è¶³
```
      - name: Assume the testing pipeline user role
        uses: aws-actions/configure-aws-credentials@v1-node16
        with:
          aws-region: ${{ env.TESTING_REGION }}
          role-to-assume: ${{ env.TESTING_PIPELINE_EXECUTION_ROLE }}
          role-session-name: feature-deployment
          role-duration-seconds: 3600
          role-skip-session-tagging: true
```

**ã‚¨ãƒ©ãƒ¼å†…å®¹**
```
(node:5491) NOTE: We are formalizing our plans to enter AWS SDK for JavaScript (v2) into maintenance mode in 2023.

Please migrate your code to use AWS SDK for JavaScript (v3).
For more information, check the migration guide at https://a.co/7PzMCcy
(Use `node --trace-warnings ...` to show where the warning was created)
Error: Not authorized to perform sts:AssumeRoleWithWebIdentity
```

ã“ã“ã¯2ç‚¹ä¿®æ­£ã‚ã‚Šã¾ã—ãŸã€‚
- 1ç‚¹ç›®
aws-actions/configure-aws-credentials@v1-node16
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ãŸã‚ã€ä¸Šã’ãªã„ã¨ã„ã‘ãªã„æ—¨ã®è­¦å‘ŠãŒå‡ºã¦ã„ã‚‹ãŸã‚ã€
å…¬å¼è¦‹ã‚‹ã¨v4ã®ä¾‹ãŒå‡ºã¦ã„ãŸã®ã§ã€v4ã«ã—ã¾ã—ãŸã€‚
https://github.com/aws-actions/configure-aws-credentials

ã“ã®ä¿®æ­£ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã›ãšã«å®Ÿè¡Œã¯ã•ã‚Œã‚‹ã®ã§ã™ãŒã€ä½•å›ã‚‚ãƒªãƒˆãƒ©ã‚¤ã—ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ãªã£ã¦ã—ã¾ã„ã€çµæœçš„ã«`sts:AssumeRoleWithWebIdentity`ã®æ¨©é™ãŒãªã„ã¨ã„ã†åŒã˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚

bootstrapã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã•ã‚ŒãŸIAMãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼é–¢ä¿‚ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã€GitHub Actionsã¨IAMãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼é–¢ä¿‚ã®è¨­å®šã«å·®ç•°ãŒã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚
```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Federated": "arn:aws:iam::{ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID}:oidc-provider/token.actions.githubusercontent.com"
            },
            "Action": "sts:AssumeRoleWithWebIdentity",
            "Condition": {
                "ForAllValues:StringLike": {
                    "token.actions.githubusercontent.com:sub": "repo:KaT0819/aws-step-function-sample:ref:refs/heads/develop",
                    "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
                }
            }
        }
    ]
}
```
`Condition`ã§æŒ‡å®šã—ã¦ã„ã‚‹ãƒ–ãƒ©ãƒ³ãƒã®æŒ‡å®šãŒ`develop`ã¨ãªã£ã¦ã„ã¾ã™ã€‚
`token.actions.githubusercontent.com:sub": "repo:KaT0819/aws-step-function-sample:ref:refs/heads/develop`
GitHub Actionsã§å‹•ä½œã—ã¦ã„ã‚‹ã®ã¯featureãƒ–ãƒ©ãƒ³ãƒã®ãŸã‚ã€ã“ã‚Œã§ã¯è¨±å¯ã•ã‚Œã¾ã›ã‚“ã€‚
ã“ã‚Œã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆãƒã‚°ã§ã¯ãªã„ã ã‚ã†ã‹ãƒ»ãƒ»ãƒ»
å¯¾è©±å½¢å¼ã§é€²ã‚ã¦ã„ã‚‹æœ€ä¸­ã«`develop`ã‚’æŒ‡å®šã—ãŸã®ã§ã€GitHub Actionsã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚`develop`ã§ã‚ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ã„ãŸã®ã§ã€yamlãƒ•ã‚¡ã‚¤ãƒ«ã®`feature**`ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```
            "Condition": {
                "ForAllValues:StringLike": {
                    "token.actions.githubusercontent.com:sub": [
		        "repo:KaT0819/aws-step-function-sample:ref:refs/heads/develop",
			"repo:KaT0819/aws-step-function-sample:ref:refs/heads/feature**"
		    ],
                    "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
                }
            }

```


## ãƒ†ã‚¹ãƒˆç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã‚¨ãƒ©ãƒ¼
```
      - name: Deploy to feature stack in the testing account
        shell: bash
        run: |
          sam deploy --stack-name $(echo ${GITHUB_REF##*/} | tr -cd '[a-zA-Z0-9-]') \
            --capabilities CAPABILITY_IAM \
            --region ${TESTING_REGION} \
            --s3-bucket ${TESTING_ARTIFACTS_BUCKET} \
            --no-fail-on-empty-changeset \
            --role-arn ${TESTING_CLOUDFORMATION_EXECUTION_ROLE}
```
**ã‚¨ãƒ©ãƒ¼å†…å®¹**
```
Error: Cannot use both --resolve-s3 and --s3-bucket parameters in non-guided deployments. Please use only one or use the --guided option for a guided deployment.
```
ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ã®`s3-bucket`ã¨`resolve-s3`ã¯åŒæ™‚ã«ä½¿ãˆãªã„ã¨ã®ã“ã¨ã€‚
`resolve-s3`ã¯ã‚³ãƒãƒ³ãƒ‰ã«æ›¸ã„ã¦ãªã„ã®ã§ä½•ã ã‚ã†ã¨æ€ã„ã¾ã—ãŸãŒã€
ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸéš›ã«ä½œæˆã•ã‚ŒãŸ`samconfig.toml`ã‚‚ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ã„ãŸã®ã§ã€
ã“ã¡ã‚‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚‚è¦‹ã¦ã—ã¾ã£ã¦ãã†ãªé›°å›²æ°—ã‚’æ„Ÿã˜ãŸã®ã§ã€
`samconfig.toml`ã‚’å‰Šé™¤ã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã€‚
ã“ã‚ŒãŒæ­£è§£ã§ã—ãŸã€‚

ã“ã‚Œã§ã‚ˆã†ã‚„ããƒ“ãƒ«ãƒ‰ãŒé€šã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã‚¨ãƒ©ãƒ¼
```
Assuming role with OIDC
Assuming role with OIDC
Assuming role with OIDC
Error: Could not assume role with OIDC: Not authorized to perform sts:AssumeRoleWithWebIdentity
```
ã¾ãŸã‚‚ã‚„AssumeRoleã®ä¸è¶³ã§ã‚¨ãƒ©ãƒ¼ã€‚
mainãƒ–ãƒ©ãƒ³ãƒãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«ã€developå´ã«ã‚‚ä½•ã‹ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ãŸã‚ã€è¨±å¯ã—ã¦ã„ã‚‹ãƒ–ãƒ©ãƒ³ãƒã®æ¡ä»¶ã«ä¸€è‡´ã›ãšã‚¨ãƒ©ãƒ¼ã§ã™ã€‚
ã‚„ã¯ã‚Šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒãƒ»ãƒ»ãƒ»
mainãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ä¸è¦ãªã®ã§ã€ãƒ†ã‚¹ãƒˆé–¢ä¿‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é™¤å»ã—ã‚ˆã†ã‹ã¨æ€ã„ã¾ã—ãŸã€‚
ãŒã€å‡ºæ¥ä¸ŠãŒã£ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å‹•ä½œã‚’ä¸€æ—¦ç¢ºèªã—ãŸã„ã¨æ€ã„ã€å¿…è¦ãªãƒ–ãƒ©ãƒ³ãƒã‚’è¨±å¯ã—ã¾ã—ãŸã€‚

ä¿®æ­£å†…å®¹ã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®å¯¾ç­–ã¨åŒæ§˜ã€`role-to-assume`ã«æŒ‡å®šã—ã¦ã„ã‚‹IAMãƒ­ãƒ¼ãƒ«ã®ä¿¡é ¼é–¢ä¿‚ã¸å¿…è¦ãªãƒ–ãƒ©ãƒ³ãƒã‚’è¿½åŠ ã—ã¦ã‚ã’ã¦è§£æ±ºã€‚


## ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—
`actions/download-artifact@v3`ã«ã‚ˆã‚‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚
```
Run actions/download-artifact@v3
Starting download for packaged-testing.yaml
Error: Unable to find any artifacts for the associated workflow
```
é¡ã£ã¦ã¿ã‚‹ã¨ã€`actions/download-artifact@v3`ã«ã‚ˆã‚‹ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§è­¦å‘ŠãŒå‡ºã¦ã„ã¾ã™ã€‚
```
Run actions/upload-artifact@v3
Warning: No files were found with the provided path: packaged-testing.yaml. No artifacts will be uploaded.
```
ã‚„ã‚ã†ã¨ã—ã¦ã‚‹ã“ã¨ã¯ã€`sam package`ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«`template.yaml`ã‚’`packaged-testing.yaml`ã¨ã„ã†åå‰æŒ‡å®šã§å‡ºåŠ›ã—ã€
ã“ã®`packaged-testing.yaml`ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€‚
æ¬¡ã®ã‚¸ãƒ§ãƒ–ã§`packaged-testing.yaml`ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã«ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

è‰²ã€…è©¦ã—ãŸçµæœã€å…ˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªéšå±¤é•ã„ãŒå½±éŸ¿ã—ã¦ãŠã‚Šã€
ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ‘ã‚¹ãŒä¸é©åˆ‡ãªéƒ¨åˆ†ã‚’ä¿®æ­£ã—ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®è­¦å‘Šã¯æ¶ˆãˆã¾ã—ãŸã€‚

ã—ã‹ã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒå–ã‚Œãšã‚¨ãƒ©ãƒ¼ã€‚ã“ã¡ã‚‰ã‚‚ãƒ‘ã‚¹ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

ãƒ‘ã‚¹é–¢ä¿‚ã®ã¿æŠœç²‹ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ã‚ã¾ã‚Šé–¢ä¿‚ãªã„éƒ¨åˆ†ã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ã«çœç•¥ã—ã¦ã„ã¾ã™ã€‚
```
  build-and-package:
    if: github.ref == 'refs/heads/main'
    needs: [test]
    defaults:
      run:
        working-directory: ./sam-step-function-sample
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: aws-actions/setup-sam@v2
      - name: Build resources
        run: sam build --template ${SAM_TEMPLATE}

      - name: Assume the testing pipeline user role
        uses: aws-actions/configure-aws-credentials@v4

      - name: Upload artifacts to testing artifact buckets
        run: |
          sam package \
            --s3-bucket ${TESTING_ARTIFACTS_BUCKET} \
            --region ${TESTING_REGION} \
            --output-template-file packaged-testing.yaml

      - uses: actions/upload-artifact@v3
        with:
          name: packaged-testing.yaml
          path: ./sam-step-function-sample/packaged-testing.yaml

      - name: Assume the prod pipeline user role
        uses: aws-actions/configure-aws-credentials@v4

      - name: Upload artifacts to production artifact buckets
        run: |
          sam package \
            --s3-bucket ${PROD_ARTIFACTS_BUCKET} \
            --region ${PROD_REGION} \
            --output-template-file packaged-prod.yaml

      - uses: actions/upload-artifact@v3
        with:
          name: packaged-prod.yaml
          path: ./sam-step-function-sample/packaged-prod.yaml

  deploy-testing:
    if: github.ref == 'refs/heads/main'
    needs: [build-and-package]
    defaults:
      run:
        working-directory: ./sam-step-function-sample
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: aws-actions/setup-sam@v2
      - uses: actions/download-artifact@v3
        with:
          name: packaged-testing.yaml

      - name: Assume the testing pipeline user role

      - name: Deploy to testing account
        run: |
          sam deploy --stack-name ${TESTING_STACK_NAME} \
            --template ../packaged-testing.yaml \
            --capabilities CAPABILITY_IAM \
            --region ${TESTING_REGION} \
            --s3-bucket ${TESTING_ARTIFACTS_BUCKET} \
            --no-fail-on-empty-changeset \
            --role-arn ${TESTING_CLOUDFORMATION_EXECUTION_ROLE}

```
defaultsã§working-directoryã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚
samã®ã‚³ãƒãƒ³ãƒ‰ã§ã¯working-directoryã®æŒ‡å®šãŒåŠ¹ã„ã¦ãã‚Œã‚‹ã®ã§ã™ãŒã€
`actions/upload-artifact`ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯åŠ¹ã„ã¦ãã‚Œãšã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã—ãŸã€‚
`actions/download-artifact`ã‚‚åŒæ§˜ã§ã™ã€‚

æœ€çµ‚ç³»ãŒã“ã¡ã‚‰
https://github.com/KaT0819/aws-step-function-sample/blob/main/.github/workflows/pipeline.yaml



# ã¾ã¨ã‚
- SAM Pipelineã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒç°¡å˜ã«ä½œæˆã§ãã¾ã™ã€‚
- OIDCã®ä¿¡é ¼é–¢ä¿‚æ§‹ç¯‰ã‚„ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®æ¨©é™å‘¨ã‚ŠãŒç°¡å˜ã«ã¤ãã‚Œã‚‹ã®ã¯è‰¯ã„ã€‚
- ä½œæˆã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯è‹¥å¹²æ§‹æˆãŒæ€ªã—ã„ã€‚
  - ãƒãƒªã‚·ãƒ¼ã®ä¿¡é ¼é–¢ä¿‚ã¨GitHubã€€Actionsã®å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ã€‚
  - ã‚³ãƒ³ãƒ†ãƒŠã§ã®sam buildãŒå¤±æ•—ã—ã¾ã™ã€‚ï¼ˆâ€»Goç‰¹æœ‰ãªè¦å› ã§ã¯ã‚ã‚Šã¾ã™ï¼‰
  - æœ¬ç•ªç”¨ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼ã®ã¯ãšãŒã€ãƒ†ã‚¹ãƒˆç”¨ã¨æœ¬ç•ªç”¨ã‚’åŒã˜ãƒ•ãƒ­ãƒ¼ã§ç¶šã‘ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã„ã¾ã™ã€‚

ã¾ã£ãŸãã®ã‚¼ãƒ­çŸ¥è­˜ã§CI/CDãŒæ§‹ç¯‰ã§ãã‚‹ã‚ã‘ã§ã¯ãªã‹ã£ãŸã®ãŒæ®‹å¿µã§ã—ãŸã€‚
IAMèªè¨¼ã§ã‚ã‚Œã°ã™ã‚“ãªã‚Šã„ã‘ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
OIDCã®å ´åˆã€AWSå´ã®ãƒ­ãƒ¼ãƒ«ã¨Actionsã®å®šç¾©ã®ãšã‚Œã‚’è¦‹ã¤ã‘ã‚‹ã®ã¯ä½•ã‚’ä½œã‚‰ã‚Œã‚‹ã‹ã‚’çŸ¥ã£ã¦ã„ãªã„ã¨è§£æ±ºã¯é›£ã—ãã†ãªæ°—ãŒã—ã¾ã—ãŸã€‚
ã“ã®è¾ºã¯ä»Šå¾Œã®SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®é€²åŒ–ã«æœŸå¾…ã§ã™ã­ã€‚

ä»Šå›ã®SAMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ¤œè¨¼ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã¯ã“ã¡ã‚‰ã€‚
Actionsã®å±¥æ­´ãŒã²ã©ã„ã“ã¨ã«ãªã£ã¦ã„ã¾ã™w
https://github.com/KaT0819/aws-step-function-sample

# å‚è€ƒã‚µã‚¤ãƒˆ
- AWSã€€CodePipelineã§ã®æ§‹ç¯‰æ‰‹é †ã§ã™ã€‚
https://aws.amazon.com/jp/builders-flash/202110/new-lambda-container-development-6/?awsf.filter-name=*all

- GitLabã§ã®æ§‹ç¯‰æ‰‹é †ã§ã™ã€‚
https://aws.amazon.com/jp/blogs/compute/introducing-aws-sam-pipelines-automatically-generate-deployment-pipelines-for-serverless-applications/

- GitHubã§ã®æ§‹ç¯‰æ‰‹é †ã§ã™ã€‚
https://zenn.dev/fusic/articles/aws-sam-pipeline-2023

- å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-generating-example-ci-cd.html
