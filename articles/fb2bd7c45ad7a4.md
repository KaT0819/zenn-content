---
title: "Stripeã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ã£ã¦å‰²å¼•ã‚’è¡Œã†"
emoji: "ğŸ“‘"
type: "tech"
topics:
  - "php"
  - "api"
  - "stripe"
  - "ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³"
  - "ã‚¯ãƒ¼ãƒãƒ³"
published: true
published_at: "2024-03-12 08:00"
---

## ã¯ã˜ã‚ã«
ä»•äº‹ã§Stripeã‚’ä½¿ã£ã¦ã‚¯ãƒ¼ãƒãƒ³ã‚’ç™ºè¡Œã™ã‚‹æ©Ÿä¼šãŒã‚ã‚Šã¾ã—ãŸã€‚
è¾¼ã¿å…¥ã£ãŸæ¡ä»¶ã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ç™ºè¡Œã§ãã‚‹ã‹èª¿æŸ»ã—ã¦ãŠã‚Šã€
é ­ã®æ•´ç†ã‚’ã‹ã­ã¦Stripeã®ã‚¯ãƒ¼ãƒãƒ³ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚
ã“ã“ã§æ‰±ã†ã®ã¯ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã™ã‚‹ã‚¯ãƒ¼ãƒãƒ³ã‚„ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
1å›é™ã‚Šã®æ”¯æ‰•ã„ã«å¯¾ã™ã‚‹ã‚¯ãƒ¼ãƒãƒ³ã«ã¤ã„ã¦ã¯æ‰±ã„ã¾ã›ã‚“ã€‚

## Stripeã«ã¤ã„ã¦
ç°¡å˜ã«æ¦‚è¦ã ã‘è§£èª¬ã—ã¾ã™ã€‚
Stripeã¯ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ”¯æ‰•ã„å‡¦ç†ã‚’ç°¡å˜ã«ã™ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚
ãƒ“ã‚¸ãƒã‚¹ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã§å®‰å…¨ã«æ±ºæ¸ˆã‚’å—ã‘å–ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

- **ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: Stripeã¯ã€ä½¿ã„ã‚„ã™ãã‚·ãƒ³ãƒ—ãƒ«ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒç‰¹å¾´ã§ã™ã€‚é–‹ç™ºè€…å‘ã‘APIã‚‚æä¾›ã•ã‚Œã¦ãŠã‚Šã€é«˜åº¦ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚‚å¯èƒ½ã§ã™ã€‚
- **å¹…åºƒã„æ±ºæ¸ˆæ‰‹æ®µ**: Stripeã¯ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€ãƒ‡ãƒ“ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€éŠ€è¡ŒæŒ¯è¾¼ã€Apple Payã€Google Payãªã©ã€å¹…åºƒã„æ±ºæ¸ˆæ‰‹æ®µã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹**: Stripeã¯ã€ä¸–ç•Œ200ãƒµå›½è¿‘ãã®å›½ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
- **é«˜ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: Stripeã¯ã€PCI DSSãªã©ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–ã‚’æº€ãŸã—ã¦ãŠã‚Šã€å®‰å…¨ãªæ±ºæ¸ˆç’°å¢ƒã‚’æä¾›ã§ãã¾ã™ã€‚
- **ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½**: Stripeã¯ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å‹ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ä¾¿åˆ©ãªã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚
- **æ‰‹æ•°æ–™**ï¼š æœˆé¡åŸºæœ¬æ–™é‡‘ã¯ãªãã€æ±ºæ¸ˆæ‰‹æ•°æ–™ã¯ã‚„ã‚„é«˜ã‚ã§ã€ä»–ç¤¾3%å‰å¾Œã«å¯¾ã—ã¦3.6%ã§ã™ã€‚

## Stripeã®ã‚¯ãƒ¼ãƒãƒ³ã«ã¤ã„ã¦
Stripeã«ãŠã‘ã‚‹ã‚¯ãƒ¼ãƒãƒ³ã¯ã€ä¸€èˆ¬çš„ãªã‚¯ãƒ¼ãƒãƒ³åˆ¸ã¨åŒæ§˜ã«ã€å•†å“ã®ä¾¡æ ¼ã‚’å‰²å¼•ã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚
ã‚¯ãƒ¼ãƒãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€å•†å“ã®å…ƒã®ä¾¡æ ¼ã‚’å¤‰ãˆã‚‹ã“ã¨ãªãã€ã‚¯ãƒ¼ãƒãƒ³ã‚’åˆ©ç”¨ã—ãŸé¡§å®¢ã«ã®ã¿å‰²å¼•ä¾¡æ ¼ã§è²©å£²ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

Stripeã§ã¯ã‚¯ãƒ¼ãƒãƒ³ã¨ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ã„ã†ä»•çµ„ã¿ã§å‰²å¼•æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚
ã‚¯ãƒ¼ãƒãƒ³ã§å‰²å¼•ã®ç¨®é¡ã€æœŸé–“ã€å¼•ãæ›ãˆå¯èƒ½ãªæ•°é‡ãªã©å¤§æ ã‚’æ±ºã‚ã¾ã™ã€‚
ã‚¯ãƒ¼ãƒãƒ³ã ã‘ã§ã‚‚å‰²å¼•ã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ãŒã€ã‚·ã‚¹ãƒ†ãƒ å´ã§å•†å“ã‚„é¡§å®¢ã«å¯¾ã—ã¦ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç‰©ç†çš„ãªã‚¯ãƒ¼ãƒãƒ³åˆ¸ã®ã‚ˆã†ã«é¡§å®¢ãŒä»»æ„ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§åˆ©ç”¨ã—ã¦é ‚ããŸã‚ã«ã¯ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã¾ã™ã€‚
ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ã‚¯ãƒ¼ãƒãƒ³ã‚’ã‚ˆã‚Šç´°ã‹ãªåˆ¶é™ã‚’ä»˜ã‘ã¦åˆ©ç”¨è€…ã‚’é™å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
ä¸€èˆ¬çš„ãªã‚¯ãƒ¼ãƒãƒ³ã¯Stripeã§ã„ã†ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã«è¿‘ã„ã¨è¨€ãˆã¾ã™ã€‚
ä»¥é™ã€ã‚¯ãƒ¼ãƒãƒ³ã€ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ã„ã†è¡¨ç¾ã¯Stripeã§ã®ã‚¯ãƒ¼ãƒãƒ³ã€ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦èª­ã¿é€²ã‚ã¦ä¸‹ã•ã„ã€‚

ä¸€ä¾‹ã¨ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªé‹ç”¨ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚
1. ã€Œåˆæœˆç„¡æ–™ã€ã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½œæˆ
2. å„æœˆæ¯ã«ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ
3. ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§ã¯ã€å„æœˆã®æœŸé–“ã«ä½¿ç”¨ã‚’åˆ¶é™


### ã‚¯ãƒ¼ãƒãƒ³ã®å‰²å¼•ç¨®é¡
å¤§ããä»¥ä¸‹ã®2ç¨®é¡ã§ã™ã€‚
- **å›ºå®šé¡å‰²å¼•**: è³¼å…¥é‡‘é¡ã‹ã‚‰ä¸€å®šé¡ã‚’å‰²ã‚Šå¼•ãã€‚
- **ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸å‰²å¼•**: è³¼å…¥é‡‘é¡ã®ç‰¹å®šã®ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’å‰²ã‚Šå¼•ãã€‚

ãã‚Œãã‚Œåå‰ã®é€šã‚Šã§ã™ãŒã€ç›®çš„ã«å¿œã˜ã¦ä½¿ã„åˆ†ã‘ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚
**å›ºå®šé¡å‰²å¼•**ã¯ã€å›ºå®šã®é‡‘é¡ã‚’å‰²ã‚Šå¼•ããŸã‚ã€é¡§å®¢ã«ã¨ã£ã¦ã‚‚æä¾›ã™ã‚‹å´ã«ã¨ã£ã¦ã‚‚å€¤å¼•ãã•ã‚Œã‚‹é¡ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã®ãŒç‰¹å¾´ã§ã™ãŒã€å•†å“ã®é‡‘é¡ãŒé«˜é¡ãªå ´åˆã§å€¤å¼•ãé¡ãŒå°ã•ã„å ´åˆã€é¡§å®¢ã«ãƒ¡ãƒªãƒƒãƒˆã‚’æ„Ÿã˜ã¦ã‚‚ã‚‰ãˆãªã„å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚
**ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸å‰²å¼•**ã¯ã€åå¯¾ã«å•†å“ã®é‡‘é¡ã«å¯¾ã—ã¦å‰²å¼•é¡ãŒå¤§ãããªã‚‹ãŸã‚ã€é¡§å®¢ã«ãƒ¡ãƒªãƒƒãƒˆã‚’æ„Ÿã˜ã¦é ‚ã‘ã‚‹ã§ã—ã‚‡ã†ã€‚ã¾ãŸã€å•†å“ã®ä¾¡æ ¼ã‚’å¤‰æ›´ã—ãŸå ´åˆã‚‚ä¸€å®šå‰²åˆã®å‰²å¼•é¡ã¨ãªã‚‹ãŸã‚ã€åˆ©ç›Šç‡ã‚’ä¸€å®šã«ã§ãã¾ã™ã€‚

### å‰²å¼•ã®ä¾¡æ ¼
- **å›ºå®šé¡å‰²å¼•**
æœ€å°é‡‘é¡ï¼š1å††
æœ€å¤§é‡‘é¡ï¼š999,999,999,999å††ï¼ˆç´„9,999å„„å††ã€€â€»æ—¥æœ¬å††ã®å ´åˆï¼‰
å›ºå®šé¡å‰²å¼•ã®å ´åˆã€é€šè²¨æ¯ã«å‰²å¼•é¡ã‚’å¤‰ãˆã‚‰ã‚Œã¾ã™ã€‚
å††ã§ã¯2,000å††å¼•ãã€ãƒ‰ãƒ«ã§ã¯10ãƒ‰ãƒ«å¼•ãã€ã®ã‚ˆã†ãªæŒ‡å®šãŒå¯èƒ½ï¼ˆç¾åœ¨ã¯1ãƒ‰ãƒ«147å††ãªã®ã§ã€æ—¥æœ¬å††ã§è³¼å…¥ã—ãŸæ–¹ãŒãŠå¾—ã«ãªã‚‹ã‚ˆã†ã«è¦‹ã›ã‚‹äº‹ãŒã§ãã¾ã™ã€‚ï¼‰

- **ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸å‰²å¼•**
æœ€å°å‰²å¼•ï¼š0.01%
æœ€å¤§å‰²å¼•ï¼š100%

0å††å‰²å¼•ã‚„ã€0ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå‰²å¼•ã®ã‚ˆã†ãªå‰²å¼•ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ãªã‚¯ãƒ¼ãƒãƒ³ã‚’ä½œæˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
åˆæœˆç„¡æ–™ã®ã‚ˆã†ãªã‚¯ãƒ¼ãƒãƒ³ã‚’ä½œã‚‹éš›ã«ã¯ã€å›ºå®šãƒ»ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã©ã¡ã‚‰ã®å‰²å¼•æ–¹æ³•ã§ã‚‚å¯èƒ½ã§ã™ãŒã€ç§ã¯ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸å‰²å¼•ã‚’ç”¨ã„ã¦100ï¼…å‰²å¼•ãªã©ã§ä½¿ç”¨ã—ã¦ã„ã¾ã™
ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã®å ´åˆã€å•†å“ã®ä¾¡æ ¼ãŒå¤‰æ›´ã«ãªã£ã¦ã‚‚åˆ©ç”¨å¯èƒ½ã§ã‚ã‚Šã€ä»–å•†å“ã«ã‚‚åˆ©ç”¨ã—ã‚„ã™ã„ã§ã™ã€‚


### å¤šæ§˜ãªå‰²å¼•åˆ¶é™
ç‰¹å®šã®å•†å“ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã€é¡§å®¢ã€æœŸé–“ã€å›æ•°ã€é‡‘é¡ãªã©æ§˜ã€…ãªæ¡ä»¶ã‚’æŒ‡å®šã—ã¦é©ç”¨å¯èƒ½ã§ã™ã€‚

#### ã‚¯ãƒ¼ãƒãƒ³ã«å¯¾ã™ã‚‹åˆ¶é™
**ã‚¯ãƒ¼ãƒãƒ³ã®æœŸé–“**
ç„¡æœŸé™ã€1å›ã€è¤‡æ•°æœˆã®3ç¨®é¡é¸æŠå¯èƒ½

- ç„¡æœŸé™ï¼šã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®å¥‘ç´„ã—ã¦ã„ã‚‹é–“å¸¸ã«ã‚¯ãƒ¼ãƒãƒ³ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚
- 1å›ï¼šã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å¥‘ç´„ã®åˆå›ã®è«‹æ±‚ã«å¯¾ã—ã¦ã®ã¿é©ç”¨ã•ã‚Œã¾ã™ã€‚
- è¤‡æ•°æœˆï¼šã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å¥‘ç´„ã‹ã‚‰æŒ‡å®šæœˆæ•°ã®è«‹æ±‚ã«å¯¾ã—ã¦ã®ã¿é©ç”¨ã•ã‚Œã¾ã™ã€‚
ä¾‹ãˆã°ã€è¤‡æ•°æœˆã§4ã‚«æœˆã‚’æŒ‡å®šã—ãŸå ´åˆã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®æœŸé–“ã«ã‚ˆã£ã¦ä»¥ä¸‹ã®ã‚ˆã†ãªé©ç”¨ã«ãªã‚Šã¾ã™ã€‚
æœˆæ¬¡ã®å ´åˆã€å„æœˆã®è«‹æ±‚ã«å¯¾ã—ã¦é©ç”¨ã•ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Š4å›åˆ†ã®è«‹æ±‚ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚
å¹´æ¬¡ã®å ´åˆã€åˆå¹´åº¦ã®è«‹æ±‚ã«å¯¾ã—ã¦é©ç”¨ã•ã‚Œã¾ã™ã€‚
é€±æ¬¡ã®å ´åˆã€å„é€±ã®è«‹æ±‚ã«å¯¾ã—ã¦4ã‚«æœˆé–“é©ç”¨ã•ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Š1ã‹æœˆ4é€±ã¨ã—ã¦ã€è¨ˆ16å›åˆ†ã®è«‹æ±‚ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚

::: message
å¾Œã»ã©è§£èª¬ã—ã¾ã™ãŒã€API ã§ã‚¯ãƒ¼ãƒãƒ³ã®æœŸé–“ã‚’è¨­å®šã™ã‚‹å ´åˆã«ã¯ã€
`duration`ã¨ã„ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæœŸé–“ã®è¨­å®šã«è©²å½“ã—ã¾ã™ã€‚
ç„¡æœŸé™ã€1å›ã€è¤‡æ•°æœˆã¯ãã‚Œãã‚Œã€`forever`ã€`once`ã€`repeating`ã¨ã„ã†è¨­å®šå€¤ã§ã™ã€‚
è¤‡æ•°æœˆã®æœˆæ•°ã®æŒ‡å®šã¯`duration_in_months`ã¨ã„ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æœˆæ•°ã‚’æŒ‡å®šã—ã¾ã™ã€‚
:::


**ã‚¯ãƒ¼ãƒãƒ³ã®å¼•ãæ›ãˆå›æ•°åˆ¶é™**
- é¡§å®¢ãŒã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ç”¨å¯èƒ½ãªæœŸé™ã®è¨­å®šãŒå¯èƒ½
æ—¥ä»˜ã ã‘ã§ãªãæ™‚é–“æŒ‡å®šã¾ã§å¯èƒ½
- ã‚¯ãƒ¼ãƒãƒ³ã®å¼•ãæ›ãˆå›æ•°ã‚’åˆ¶é™å¯èƒ½

ã“ã“ã§ã®å¼•ãæ›ãˆå›æ•°ã¯å¼•ãæ›ãˆå›æ•°åˆ¶é™ã¯ã€é¡§å®¢å…¨ä½“ã®ã‚¯ãƒ¼ãƒãƒ³ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚
50å›ã«åˆ¶é™ã—ãŸå ´åˆã€åŒã˜é¡§å®¢ãŒ50å›é©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã—ã€åˆ¥ã€…ãªé¡§å®¢50äººãŒ1å›ãšã¤é©ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
é¡§å®¢ã«å¯¾ã—ã¦1å›ã ã‘ä½¿ã‚ã›ãŸã„å ´åˆã¯ã€ã‚¯ãƒ¼ãƒãƒ³ã®å›æ•°åˆ¶é™ã¯è¨­å®šã›ãšã€ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®šã§æŒ‡å®šã—ã¾ã™ã€‚
ã‚¯ãƒ¼ãƒãƒ³ã®å¼•ãæ›ãˆå›æ•°åˆ¶é™ã‚’1å›ã¨ã—ãŸå ´åˆã€æœ€åˆã«ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ç”¨ã—ãŸä¸€äººã ã‘ãŒä½¿ç”¨ã§ãã‚‹ã‚¯ãƒ¼ãƒãƒ³ã¨ãªã‚Šã¾ã™ã€‚

ç‰¹æ®Šãªä¾‹ã¨ã—ã¦ã€æ°¸ç¶šçš„ã«ç¶™ç¶šã™ã‚‹ã‚ˆã†ãªå‰²å¼•è¨­å®šã‚’ã—ãŸã‚¯ãƒ¼ãƒãƒ³ã§æœ‰åŠ¹æœŸé™ãŒã‚ã‚‹å ´åˆã€ãã®ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã—ãŸé¡§å®¢ã¯æ°¸ç¶šçš„ã«ãã®å‰²å¼•ã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
æœ‰åŠ¹æœŸé™å¾Œã«é¡§å®¢ãŒã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚


#### ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹åˆ¶é™
**åˆå›æ³¨æ–‡ã®å ´åˆã®ã¿ä½¿ç”¨å¯èƒ½**
é¡§å®¢ã”ã¨ã«åˆã‚ã¦è³¼å…¥ã™ã‚‹éš›ã«ã®ã¿ä½¿ç”¨å¯èƒ½
**ç‰¹å®šã®é¡§å®¢ã«ä½¿ç”¨ã‚’é™å®š**
äº‹å‰ã«é¡§å®¢ã‚’ã‚¯ãƒ¼ãƒãƒ³ã«ç´ã¥ã‘ã‚‹ã“ã¨ã§ã€å¯¾è±¡é¡§å®¢ã®ã¿ã«ã—ã‹ä½¿ç”¨ã§ããªã„ã‚ˆã†ã«ã§ãã¾ã™ã€‚
**ã‚³ãƒ¼ãƒ‰ã®å¼•ãæ›ãˆå›æ•°ã‚’åˆ¶é™**
ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®ä½¿ç”¨å›æ•°ã‚’åˆ¶é™ã§ãã¾ã™ã€‚
ã‚¯ãƒ¼ãƒãƒ³ã®å¼•ãæ›ãˆå›æ•°åˆ¶é™ã‚’ã—ã¦ã„ã‚‹å ´åˆã€ãã®æ•°ã‚’è¶…ãˆã¦è¨­å®šã¯ã§ãã¾ã›ã‚“ã€‚
**æœ‰åŠ¹æœŸé™ã‚’è¨­å®š**
ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®æœ‰åŠ¹æœŸé™ã‚’åˆ¶é™ã§ãã¾ã™ã€‚
ã‚¯ãƒ¼ãƒãƒ³ã®å¼•ãæ›ãˆæœŸé™ã‚’è¨­å®šã‚’ã—ã¦ã„ã‚‹å ´åˆã€ãã®æœŸé™ã‚’è¶…ãˆã¦è¨­å®šã¯ã§ãã¾ã›ã‚“ã€‚
**æœ€å°æ³¨æ–‡é‡‘é¡ã®è¨­å®š**
å•†å“ã®è³¼å…¥é‡‘é¡ãŒä¸€å®šä¸Šã®å ´åˆã«åˆ©ç”¨å¯èƒ½ã¨ã™ã‚‹ã€‚
ã‚¯ãƒ¼ãƒãƒ³ã¨ã¯é•ã„ã¾ã™ãŒã€2000å††ä»¥ä¸Šãªã‚‰é€æ–™ç„¡æ–™ã€ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸
ç¨é‡‘ã‚’å«ã‚ã‚‹å«ã‚ãªã„ã®æŒ‡å®šã‚‚å¯èƒ½


## å•†å“ã®è²©å£²æ–¹æ³•ã«ã‚ˆã‚‹ã‚¯ãƒ¼ãƒãƒ³ã®è¨­å®šæ–¹æ³•
ä»¥é™ã¯å®Ÿéš›ã«å•†å“ã«ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã™ã‚‹ã¾ã§ã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚
Stripeã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè©³ã—ãæ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§åŸºæœ¬çš„ã«ã¯ãã¡ã‚‰ã‚’å‚è€ƒã«ã™ã‚Œã°è¨­å®šã¯å¯èƒ½ã ã¨æ€ã„ã¾ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯ã€Stripeã®APIï¼ˆç‰¹ã«PHPã§ã®SDKä½¿ç”¨æ™‚ï¼‰ã‚’ç”¨ã„ãŸå ´åˆã«ã©ã†ã„ã†å‹•ä½œã«ãªã‚‹ã‹ã‚’ãƒ¡ã‚¤ãƒ³ã«è§£èª¬ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¦‹æ–¹
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ã„ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ã¨ã€ŒAPIã€ã¨æ›¸ã‹ã‚ŒãŸã‚¿ãƒ–ã«ãªã£ã¦ã„ã‚‹ç®‡æ‰€ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/e70214b7ec4b-20240309.png)

åˆæœŸè¡¨ç¤ºã¯å›³ã®ã‚ˆã†ã«ã€Œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ã®æ–¹ãŒè¦‹ãˆã¦ã„ã¾ã™ãŒã€
ã€ŒAPIã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã§APIã¨ã—ã¦ã®ã‚³ãƒ¼ãƒ‰å®Ÿè£…ä¾‹ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/82e1dcaee0ba-20240309.png)
ã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å³ä¸Šã®ä¸‹çŸ¢å°ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å¯¾å¿œã—ãŸã‚³ãƒ¼ãƒ‰ä¾‹ã‚’è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ã€‚
Stripeã®APIã¯æ§˜ã€…ãªè¨€èªã«å¯¾å¿œã—ã¦ãŠã‚Šã€å„è¨€èªç”¨ã«`SDK`ã¨å‘¼ã°ã‚Œã‚‹APIã‚’ä¾¿åˆ©ã«åˆ©ç”¨ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã—ã¦ã„ã‚‹ãŸã‚ã€SDKã®å®Ÿè£…ä¾‹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/7ab685e5ecfe-20240309.png)
ä¸€ç•ªå³ã«ã‚ã‚‹å®Ÿè¡Œã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã«Stripe Shellã¨ã„ã†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
Stripe CLIã®ã‚³ãƒãƒ³ãƒ‰ãŒæ›¸ãå‡ºã•ã‚ŒãŸçŠ¶æ…‹ã«ãªã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ãã®ã¾ã¾ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å†…å®¹ã§å®Ÿè¡Œã—ãŸçµæœã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã“ã§å®Ÿè¡Œã—ãŸå†…å®¹ã¯Stripeã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã«åæ˜ ã•ã‚Œã¾ã™ã®ã§ã€å®‰å…¨ã«å®Ÿè¡Œç¢ºèªãŒå¯èƒ½ã§ã™ã€‚
â€»å®Ÿè¡Œã—ãŸçµæœã€æ¤œè¨¼ç’°å¢ƒã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€ä½•ãŒèµ·ãã‚‹ã‹åˆ†ã‹ã‚‰ãªã„å ´åˆã¯ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®æ‰‹é †ã§æ“ä½œã—ã¦ã¿ã¦ã©ã®ãƒšãƒ¼ã‚¸ã®ä½•ãŒå¤‰ã‚ã‚‹ã®ã‹ã‚’ç¢ºèªã—ãŸã†ãˆã§å®Ÿè¡Œã™ã‚‹ã®ãŒã‚ˆã„ã§ã—ã‚‡ã†ã€‚

APIã®è©³ç´°ã‚’çŸ¥ã‚ŠãŸã„å ´åˆã€ã‚³ãƒ¼ãƒ‰ã®é–¢æ•°éƒ¨åˆ†ã«ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã‚‹ã¨å¯¾å¿œã™ã‚‹APIã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¸ã®ãƒªãƒ³ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ã“ã®æ©Ÿèƒ½ã‚’ä½¿ã†ã¨ç°¡å˜ã«APIã®è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/20598ab72d39-20240309.png)


## ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®å‰²å¼•
https://docs.stripe.com/billing/subscriptions/coupons

### ã‚¯ãƒ¼ãƒãƒ³ã®ä½œæˆ
ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚
```php
// Set your secret key. Remember to switch to your live secret key in production.
// See your keys here: https://dashboard.stripe.com/apikeys
$stripe = new \Stripe\StripeClient('Stripeã‚­ãƒ¼');

$stripe->coupons->create([
  'duration' => 'once',
  'id' => 'free-period',
  'percent_off' => 100,
]);
```

**APIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è©³ç´°**
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æŒ‡å®šã—ãªãã¦ã‚‚ã‚ˆã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚

**å¿…é ˆã¨ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**
è¨­å®š | èª¬æ˜
--- | ---
percent_off ã¾ãŸã¯ amount_off | ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸å‰²å¼• ã‹ å›ºå®šé¡å‰²å¼•ã©ã¡ã‚‰ã‹ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
duration | ã‚¯ãƒ¼ãƒãƒ³ã®æœ‰åŠ¹æœŸé–“ã€‚onceï¼ˆ1å›ï¼‰ã€foreverï¼ˆç„¡æœŸé™ï¼‰ã€repeatingï¼ˆè¤‡æ•°æœˆï¼‰ ã®ã„ãšã‚Œã‹ã€‚è¤‡æ•°æœˆã‚’æŒ‡å®šã—ãŸå ´åˆã€duration_in_monthsã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æœˆæ•°ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
duration_in_months | ã‚¯ãƒ¼ãƒãƒ³ã®æœ‰åŠ¹æœŸé™ã§è¤‡æ•°æœˆã‚’æŒ‡å®šã—ãŸå ´åˆå¿…é ˆã€‚æœˆæ•°
currency | å›ºå®šé¡å‰²å¼•ã®å ´åˆå¿…é ˆã€‚å‰²å¼•é‡‘é¡ã®é€šè²¨ã‚³ãƒ¼ãƒ‰ã€‚3æ–‡å­—ã®ISOã‚³ãƒ¼ãƒ‰
currency_options | å›ºå®šé¡å‰²å¼•ã®å ´åˆå¿…é ˆã€‚ç•°ãªã‚‹é€šè²¨ã§å°è¨ˆã‹ã‚‰å·®ã—å¼•ãé‡‘é¡ã€‚å¤šé€šè²¨ã§ã®è²©å£²æ™‚ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã†

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³**
è¨­å®š | èª¬æ˜
--- | ---
id  | ã‚¯ãƒ¼ãƒãƒ³ã®ä¸€æ„ã®IDã€‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¡¨ç¤ºã•ã‚Œã‚‹åå‰ã§ã™ã€‚ã™ã§ã«ç™»éŒ²æ¸ˆã¿ã®åå‰ã¯æŒ‡å®šä¸å¯
max_redemptions | ã‚¯ãƒ¼ãƒãƒ³ã®æœ€å¤§å¼•ãæ›ãˆå›æ•°
name | è«‹æ±‚æ›¸ã‚„é ˜åæ›¸ãªã©ã«é¡§å®¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¯ãƒ¼ãƒãƒ³ã®åå‰ã€‚åå‰ãŒæœªè¨­å®šã®å ´åˆIDãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
redeem_by | ã‚¯ãƒ¼ãƒãƒ³ã®åˆ©ç”¨æœŸé™ã‚’è¨­å®š
applies_to | ç‰¹å®šã®å•†å“ã«ã®ã¿ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã™ã‚‹å ´åˆã«æŒ‡å®š
metadata | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€‚ã‚¯ãƒ¼ãƒãƒ³ã®è¨­å®šã¨ã„ã†ã‚ˆã‚Šã¯ãƒ‡ãƒ¼ã‚¿ç®¡ç†ä¸Šã‚«ãƒ†ã‚´ãƒªåˆ†ã‘ã™ã‚‹ç›®çš„ã§ä»˜ã‘ã‚‹ã‚¿ã‚°ã®ã‚ˆã†ãªã‚‚ã®ã€‚

https://docs.stripe.com/api/coupons/create

### ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã™ã‚‹
ä½œæˆã—ãŸã‚¯ãƒ¼ãƒãƒ³ã‚’ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã—ã¾ã™ã€‚
```php
// Set your secret key. Remember to switch to your live secret key in production.
// See your keys here: https://dashboard.stripe.com/apikeys
$stripe = new \Stripe\StripeClient('Stripeã‚­ãƒ¼');

$stripe->subscriptions->create([
  'customer' => 'cus_4fdAW5ftNQow1a',
  'items' => [['price' => 'price_CBb6IXqvTLXp3f']],
  'coupon' => 'free-period',
]);
```

**å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã‚¯ãƒ¼ãƒãƒ³ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|-------|------|
| customer | å¿…é ˆã€‚ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã™ã‚‹é¡§å®¢ã®ID |
| items | å¿…é ˆã€‚ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã™ã‚‹æ–™é‡‘æƒ…å ±ã®ãƒªã‚¹ãƒˆã€‚æœ€ä½é™æ–™é‡‘ã®IDã‚’è¨­å®šã™ã‚‹ã€‚1ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚ãŸã‚Šæœ€å¤§20å€‹ã¾ã§æŒã¦ã‚‹ |
| coupon | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã•ã‚Œã‚‹ã‚¯ãƒ¼ãƒãƒ³ID |
| promotion_code | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®API ID |


APIã®ä¾‹ã§ã™ãŒã€ã“ã®ã¾ã¾ã§ã¯å‹•ä½œã—ã¾ã›ã‚“ã€‚
ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æŒ‡å®šã—ã¦ã„ã‚‹é¡§å®¢(customer)ã¨å•†å“ã®æ–™é‡‘(itemsã®price)ãŒå­˜åœ¨ã—ãªã„IDã‚’æŒ‡å®šã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚
å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€ã¾ãšã¯é¡§å®¢ã¨æ–™é‡‘ã‚’ä½œæˆã—ã¾ã™ã€‚æ–™é‡‘ã¯å•†å“ã‚’ä½œã‚‹æ®µéšã§ä½œæˆã•ã‚Œã¾ã™ã€‚
ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰å¿…è¦ãªå€¤ã‚’è¨­å®šã—ã¦ä½œæˆã—ã¾ã™ã€‚

ãã‚Œãã‚Œèµ¤æ ã®éƒ¨åˆ†ã®IDã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
**é¡§å®¢**
![](https://storage.googleapis.com/zenn-user-upload/2edd75daa583-20240309.png)
**å•†å“ã¨æ–™é‡‘**
![](https://storage.googleapis.com/zenn-user-upload/a71b81aefa07-20240309.png)
ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®å•†å“ã‚’ä½œæˆã™ã‚‹å ´åˆã€ã€Œç¶™ç¶šã€ã‚’é¸æŠã—ã¾ã™ã€‚
è«‹æ±‚æœŸé–“ã¯ä½•ã§ã‚‚ã‚ˆã„ã§ã™ãŒã€ä¸€èˆ¬çš„ãªæœˆæ¬¡ã¨ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/6406c15f21a2-20240309.png)

é¡§å®¢ã¨æ–™é‡‘ãŒä½œã‚ŒãŸã‚‰ã€APIã®å®Ÿè¡Œæ™‚ã«ãã‚Œãã‚Œã®IDã‚’ä½œæˆã—ãŸIDã«å·®ã—æ›¿ãˆã¦å®Ÿè¡Œã—ã¾ã™ã€‚

:::details APIå®Ÿè¡Œçµæœã€€â€»é•·ã„ã®ã§æŠ˜ã‚Šç•³ã¿
```json
{
  "id": "sub_1OsM9sFikfoKKsrjHqZzOAsP",
  "object": "subscription",
  "application": null,
  "application_fee_percent": null,
  "automatic_tax": {
    "enabled": false,
    "liability": null
  },
  "billing_cycle_anchor": 1709976336,
  "billing_cycle_anchor_config": null,
  "billing_thresholds": null,
  "cancel_at": null,
  "cancel_at_period_end": false,
  "canceled_at": null,
  "cancellation_details": {
    "comment": null,
    "feedback": null,
    "reason": null
  },
  "collection_method": "charge_automatically",
  "created": 1709976336,
  "currency": "jpy",
  "current_period_end": 1712654736,
  "current_period_start": 1709976336,
  "customer": "cus_PhlUvCVhPDCxIV",
  "days_until_due": null,
  "default_payment_method": null,
  "default_source": null,
  "default_tax_rates": [],
  "description": null,
  "discount": null,
  "ended_at": null,
  "invoice_settings": {
    "account_tax_ids": null,
    "issuer": {
      "type": "self"
    }
  },
  "items": {
    "object": "list",
    "data": [
      {
        "id": "si_Phlh1FbC3Rz7a3",
        "object": "subscription_item",
        "billing_thresholds": null,
        "created": 1709976336,
        "metadata": {},
        "plan": {
          "id": "price_1OsM4aFikfoKKsrjeQJASruq",
          "object": "plan",
          "active": true,
          "aggregate_usage": null,
          "amount": 1000,
          "amount_decimal": "1000",
          "billing_scheme": "per_unit",
          "created": 1709976008,
          "currency": "jpy",
          "interval": "month",
          "interval_count": 1,
          "livemode": false,
          "metadata": {},
          "nickname": null,
          "product": "prod_Phlb3znCji5wyN",
          "tiers_mode": null,
          "transform_usage": null,
          "trial_period_days": null,
          "usage_type": "licensed"
        },
        "price": {
          "id": "price_1OsM4aFikfoKKsrjeQJASruq",
          "object": "price",
          "active": true,
          "billing_scheme": "per_unit",
          "created": 1709976008,
          "currency": "jpy",
          "custom_unit_amount": null,
          "livemode": false,
          "lookup_key": null,
          "metadata": {},
          "nickname": null,
          "product": "prod_Phlb3znCji5wyN",
          "recurring": {
            "aggregate_usage": null,
            "interval": "month",
            "interval_count": 1,
            "trial_period_days": null,
            "usage_type": "licensed"
          },
          "tax_behavior": "unspecified",
          "tiers_mode": null,
          "transform_quantity": null,
          "type": "recurring",
          "unit_amount": 1000,
          "unit_amount_decimal": "1000"
        },
        "quantity": 1,
        "subscription": "sub_1OsM9sFikfoKKsrjHqZzOAsP",
        "tax_rates": []
      }
    ],
    "has_more": false,
    "total_count": 1,
    "url": "/v1/subscription_items?subscription=sub_1OsM9sFikfoKKsrjHqZzOAsP"
  },
  "latest_invoice": "in_1OsM9sFikfoKKsrj59qF3BIG",
  "livemode": false,
  "metadata": {},
  "next_pending_invoice_item_invoice": null,
  "on_behalf_of": null,
  "pause_collection": null,
  "payment_settings": {
    "payment_method_options": null,
    "payment_method_types": null,
    "save_default_payment_method": "off"
  },
  "pending_invoice_item_interval": null,
  "pending_setup_intent": "seti_1OsM9sFikfoKKsrjkZYEojhj",
  "pending_update": null,
  "plan": {
    "id": "price_1OsM4aFikfoKKsrjeQJASruq",
    "object": "plan",
    "active": true,
    "aggregate_usage": null,
    "amount": 1000,
    "amount_decimal": "1000",
    "billing_scheme": "per_unit",
    "created": 1709976008,
    "currency": "jpy",
    "interval": "month",
    "interval_count": 1,
    "livemode": false,
    "metadata": {},
    "nickname": null,
    "product": "prod_Phlb3znCji5wyN",
    "tiers_mode": null,
    "transform_usage": null,
    "trial_period_days": null,
    "usage_type": "licensed"
  },
  "quantity": 1,
  "schedule": null,
  "start_date": 1709976336,
  "status": "active",
  "test_clock": null,
  "transfer_data": null,
  "trial_end": null,
  "trial_settings": {
    "end_behavior": {
      "missing_payment_method": "create_invoice"
    }
  },
  "trial_start": null
}
```
:::

https://docs.stripe.com/api/subscriptions/create


ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®æ›´æ–°æ™‚ã‚‚ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã§ãã¾ã™ã€‚
```php
$stripe = new \Stripe\StripeClient('Stripeã‚­ãƒ¼');

$stripe->subscriptions->update(
  'sub_1MowQVLkdIwHu7ixeRlqHVzs',
  ['coupon' => 'free-period']
);
```

https://docs.stripe.com/api/subscriptions/update

**ã‚¯ãƒ¼ãƒãƒ³ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**
å¿…é ˆã¨ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®IDä»¥å¤–ã¯ç‰¹ã«ãªãã™ã¹ã¦ä»»æ„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|-------|------|
| coupon | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã•ã‚Œã‚‹ã‚¯ãƒ¼ãƒãƒ³ID |
| promotion_code | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®API ID |

:::details APIå®Ÿè¡Œçµæœã€€â€»é•·ã„ã®ã§æŠ˜ã‚Šç•³ã¿
`discount`ã®`coupon`ã«æ›´æ–°ã—ãŸã‚¯ãƒ¼ãƒãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```json
{
  "id": "sub_1OsM9sFikfoKKsrjHqZzOAsP",
  "object": "subscription",
  "application": null,
  "application_fee_percent": null,
  "automatic_tax": {
    "enabled": false,
    "liability": null
  },
  "billing_cycle_anchor": 1709976336,
  "billing_cycle_anchor_config": null,
  "billing_thresholds": null,
  "cancel_at": null,
  "cancel_at_period_end": false,
  "canceled_at": null,
  "cancellation_details": {
    "comment": null,
    "feedback": null,
    "reason": null
  },
  "collection_method": "charge_automatically",
  "created": 1709976336,
  "currency": "jpy",
  "current_period_end": 1712654736,
  "current_period_start": 1709976336,
  "customer": "cus_PhlUvCVhPDCxIV",
  "days_until_due": null,
  "default_payment_method": null,
  "default_source": null,
  "default_tax_rates": [],
  "description": null,
  "discount": {
    "id": "di_1OsSMbFikfoKKsrj96chMZgl",
    "object": "discount",
    "checkout_session": null,
    "coupon": {
      "id": "free-period",
      "object": "coupon",
      "amount_off": null,
      "created": 1709970512,
      "currency": null,
      "duration": "once",
      "duration_in_months": null,
      "livemode": false,
      "max_redemptions": null,
      "metadata": {},
      "name": null,
      "percent_off": 100,
      "redeem_by": null,
      "times_redeemed": 2,
      "valid": true
    },
    "customer": "cus_PhlUvCVhPDCxIV",
    "end": null,
    "invoice": null,
    "invoice_item": null,
    "promotion_code": null,
    "start": 1710000189,
    "subscription": "sub_1OsM9sFikfoKKsrjHqZzOAsP"
  },
  "ended_at": null,
  "invoice_settings": {
    "account_tax_ids": null,
    "issuer": {
      "type": "self"
    }
  },
  "items": {
    "object": "list",
    "data": [
      {
        "id": "si_Phlh1FbC3Rz7a3",
        "object": "subscription_item",
        "billing_thresholds": null,
        "created": 1709976336,
        "metadata": {},
        "plan": {
          "id": "price_1OsM4aFikfoKKsrjeQJASruq",
          "object": "plan",
          "active": true,
          "aggregate_usage": null,
          "amount": 1000,
          "amount_decimal": "1000",
          "billing_scheme": "per_unit",
          "created": 1709976008,
          "currency": "jpy",
          "interval": "month",
          "interval_count": 1,
          "livemode": false,
          "metadata": {},
          "nickname": null,
          "product": "prod_Phlb3znCji5wyN",
          "tiers_mode": null,
          "transform_usage": null,
          "trial_period_days": null,
          "usage_type": "licensed"
        },
        "price": {
          "id": "price_1OsM4aFikfoKKsrjeQJASruq",
          "object": "price",
          "active": true,
          "billing_scheme": "per_unit",
          "created": 1709976008,
          "currency": "jpy",
          "custom_unit_amount": null,
          "livemode": false,
          "lookup_key": null,
          "metadata": {},
          "nickname": null,
          "product": "prod_Phlb3znCji5wyN",
          "recurring": {
            "aggregate_usage": null,
            "interval": "month",
            "interval_count": 1,
            "trial_period_days": null,
            "usage_type": "licensed"
          },
          "tax_behavior": "unspecified",
          "tiers_mode": null,
          "transform_quantity": null,
          "type": "recurring",
          "unit_amount": 1000,
          "unit_amount_decimal": "1000"
        },
        "quantity": 1,
        "subscription": "sub_1OsM9sFikfoKKsrjHqZzOAsP",
        "tax_rates": []
      }
    ],
    "has_more": false,
    "total_count": 1,
    "url": "/v1/subscription_items?subscription=sub_1OsM9sFikfoKKsrjHqZzOAsP"
  },
  "latest_invoice": "in_1OsM9sFikfoKKsrj59qF3BIG",
  "livemode": false,
  "metadata": {},
  "next_pending_invoice_item_invoice": null,
  "on_behalf_of": null,
  "pause_collection": null,
  "payment_settings": {
    "payment_method_options": null,
    "payment_method_types": null,
    "save_default_payment_method": "off"
  },
  "pending_invoice_item_interval": null,
  "pending_setup_intent": "seti_1OsM9sFikfoKKsrjkZYEojhj",
  "pending_update": null,
  "plan": {
    "id": "price_1OsM4aFikfoKKsrjeQJASruq",
    "object": "plan",
    "active": true,
    "aggregate_usage": null,
    "amount": 1000,
    "amount_decimal": "1000",
    "billing_scheme": "per_unit",
    "created": 1709976008,
    "currency": "jpy",
    "interval": "month",
    "interval_count": 1,
    "livemode": false,
    "metadata": {},
    "nickname": null,
    "product": "prod_Phlb3znCji5wyN",
    "tiers_mode": null,
    "transform_usage": null,
    "trial_period_days": null,
    "usage_type": "licensed"
  },
  "quantity": 1,
  "schedule": null,
  "start_date": 1709976336,
  "status": "active",
  "test_clock": null,
  "transfer_data": null,
  "trial_end": null,
  "trial_settings": {
    "end_behavior": {
      "missing_payment_method": "create_invoice"
    }
  },
  "trial_start": null
}
```
:::


### é¡§å®¢ã«ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã™ã‚‹
ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ãªãã€é¡§å®¢è‡ªä½“ã«ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚
ãã®é¡§å®¢ãŒæŒã¤ã™ã¹ã¦ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã•ã‚Œã€ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã—ãŸå¾Œã«è¿½åŠ ã—ãŸã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚‚åŒæ§˜ã«ã‚¯ãƒ¼ãƒãƒ³ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚
ä¸€èˆ¬çš„ãªé¡§å®¢ã«é©ç”¨ã™ã‚‹ã«ã¯é›£ã—ãã†ã€‚é™å®šçš„ãªæ©Ÿèƒ½ã¨ã—ã¦åˆ©ç”¨ã§ããã†ã§ã™ã€‚
- ç®¡ç†ç”¨ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã—ã¦è²»ç”¨ãŒæ›ã‹ã‚‰ãªã„ã‚ˆã†ã«å‰²å¼•ã‚¯ãƒ¼ãƒãƒ³ã§ç„¡æ–™ã«ã™ã‚‹
- æ—©æœŸè³¼å…¥ç‰¹å…¸ã¨ã—ã¦ã€æ°¸å¹´20%å¼•ãã«ã™ã‚‹

:::message
**å‰²å¼•ã®å„ªå…ˆåº¦**
1 ã¤ã®ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã«é©ç”¨ã§ãã‚‹ã‚¯ãƒ¼ãƒãƒ³ã¯ 1 ã¤ã ã‘ã§ã™ã€‚
2 ã¤ä»¥ä¸Šã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½µç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã•ã‚Œã‚‹ã‚¯ãƒ¼ãƒãƒ³ã¯ã€é¡§å®¢ã«é©ç”¨ã•ã‚Œã‚‹ã‚¯ãƒ¼ãƒãƒ³ã‚ˆã‚Šã‚‚å„ªå…ˆã•ã‚Œã¾ã™ã€‚
:::

é¡§å®¢ä½œæˆæ™‚ã«ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã—ã¾ã™ã€‚
```php
$stripe = new \Stripe\StripeClient('Stripeã‚­ãƒ¼');

$stripe->customers->create([
  'name' => 'Jenny Rosen',
  'email' => 'jennyrosen@example.com',
  'coupon' => 'free-period',
]);
```

**å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã‚¯ãƒ¼ãƒãƒ³ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**
APIçš„ã«ã¯å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ãªã—ã€‚
ä½•ã‚‚æŒ‡å®šã›ãšé¡§å®¢ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚åå‰æœªè¨­å®šã€emailæœªè¨­å®šãªé¡§å®¢ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|-------|------|
| coupon | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã•ã‚Œã‚‹ã‚¯ãƒ¼ãƒãƒ³ID |
| promotion_code | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®API ID |

:::details APIå®Ÿè¡Œçµæœã€€â€»é•·ã„ã®ã§æŠ˜ã‚Šç•³ã¿
```json
{
  "id": "cus_PhsaVPG9FhMTGz",
  "object": "customer",
  "address": null,
  "balance": 0,
  "created": 1710001944,
  "currency": null,
  "default_currency": null,
  "default_source": null,
  "delinquent": false,
  "description": null,
  "discount": {
    "id": "di_1OsSouFikfoKKsrjcPRRNP29",
    "object": "discount",
    "checkout_session": null,
    "coupon": {
      "id": "free-period",
      "object": "coupon",
      "amount_off": null,
      "created": 1709970512,
      "currency": null,
      "duration": "once",
      "duration_in_months": null,
      "livemode": false,
      "max_redemptions": null,
      "metadata": {},
      "name": null,
      "percent_off": 100,
      "redeem_by": null,
      "times_redeemed": 4,
      "valid": true
    },
    "customer": "cus_PhsaVPG9FhMTGz",
    "end": null,
    "invoice": null,
    "invoice_item": null,
    "promotion_code": null,
    "start": 1710001944,
    "subscription": null
  },
  "email": "jennyrosen@example.com",
  "invoice_prefix": "B4187977",
  "invoice_settings": {
    "custom_fields": null,
    "default_payment_method": null,
    "footer": null,
    "rendering_options": null
  },
  "livemode": false,
  "metadata": {},
  "name": "Jenny Rosen",
  "next_invoice_sequence": 1,
  "phone": null,
  "preferred_locales": [],
  "shipping": null,
  "tax_exempt": "none",
  "test_clock": null
}
```
:::

https://docs.stripe.com/api/subscriptions/create


é¡§å®¢æ›´æ–°APIã‚‚ä½œæˆã¨åŒæ§˜ã«ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã§ãã¾ã™ã€‚
```php
$stripe = new \Stripe\StripeClient('Stripeã‚­ãƒ¼');

$stripe->customers->update(
  'cus_NffrFeUfNV2Hib',
  'coupon' => 'free-period',
]);
```

https://docs.stripe.com/api/subscriptions/update


### Checkoutã«ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã™ã‚‹
Checkoutã¯StripeãŒæä¾›ã™ã‚‹ãƒ­ãƒ¼ã‚³ãƒ¼ãƒ‰ã®æ”¯æ‰•ã„ãƒ•ã‚©ãƒ¼ãƒ ã«ã‚ˆã‚‹æ±ºæ¸ˆæ©Ÿèƒ½ã§ã™ã€‚
Stripeã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã¯ã€ã€ŒPayment Linksã€ã«è©²å½“ã—ã¾ã™ã€‚
Checkoutã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ç›´æ¥åŸ‹ã‚è¾¼ã‚“ã ã‚Šã€StripeãŒæä¾›ã—ã¦ã„ã‚‹æ±ºæ¸ˆãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã“ã¨ã§æ±ºæ¸ˆã‚’å®Ÿç¾ã—ã¾ã™ã€‚

Checkoutã‚’ã‚¯ãƒ¼ãƒãƒ³ä»˜ãã§æä¾›ã™ã‚‹ãŸã‚ã®APIå‘¼ã³å‡ºã—ã§ã™ã€‚
Checkoutã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆAPIã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«`discounts`ã‚’è¨­å®šã—ã¾ã™ã€‚

```php
// Set your secret key. Remember to switch to your live secret key in production.
// See your keys here: https://dashboard.stripe.com/apikeys
\Stripe\Stripe::setApiKey('Stripeã‚­ãƒ¼');

$session = \Stripe\Checkout\Session::create([
  'payment_method_types' => ['card'],
  'line_items' => [[
    'price' => '{{PRICE_ID}}',
    'quantity' => 1,
  ]],
  'mode' => 'subscription',
  'discounts' => [[
    'coupon' => '{{COUPON_ID}}',
  ]],
  'success_url' => 'https://example.com/success',
  'cancel_url' => 'https://example.com/cancel',
]);
```

**å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã‚¯ãƒ¼ãƒãƒ³ã«é–¢ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|-------|------|
| line_items | ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ‰ä»¥å¤–ã§ã¯å¿…é ˆã€‚é¡§å®¢ãŒè³¼å…¥ã—ã¦ã„ã‚‹å•†å“ã®ãƒªã‚¹ãƒˆ |
| mode | å¿…é ˆã€‚ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ¢ãƒ¼ãƒ‰ã€‚`payment`ï¼š1å›æ‰•ã„ã€`setup`ï¼šå¾Œæ‰•ã„ã€`subscription`ï¼šã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®3ç¨®é¡ |
| return_url | æ¡ä»¶ä»˜ãã§å¿…é ˆã€‚æ”¯æ‰•ã„èªè¨¼å¾Œã‚„ã€æ”¯æ‰•ã„ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸå¾Œã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹URLã€‚`ui_mode`ãŒ`enbedded`ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ™ãƒ¼ã‚¹ã®æ”¯æ‰•ã„æ–¹æ³•ã®å ´åˆã«å¿…é ˆã€‚ |
| success_url | æ¡ä»¶ä»˜ãã§å¿…é ˆã€‚`ui_mode`ãŒ`enbedded`åŸ‹ã‚è¾¼ã¿ã®å ´åˆã¯åˆ©ç”¨ä¸å¯ã€‚ |
| currency | æ¡ä»¶ä»˜ãã§å¿…é ˆã€‚`mode`ãŒ`setup`ã§ã€`payment_method_types`ãŒæœªè¨­å®šã®å ´åˆã«å¿…é ˆ |
| payment_method_types | ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆãªã©ã®æ±ºæ¸ˆæ‰‹æ®µã®ç¨®é¡ |
| discounts | ã‚¯ãƒ¼ãƒãƒ³ã‹ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã™ã‚‹ã€‚ |
| discounts.coupon | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã•ã‚Œã‚‹ã‚¯ãƒ¼ãƒãƒ³ID |
| discounts.promotion_code | ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«é©ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®ID |

https://docs.stripe.com/api/checkout/sessions/create

#### Checkoutã«ã¤ã„ã¦
https://docs.stripe.com/payments/checkout



### ã‚¯ãƒ¼ãƒãƒ³ã‚’å‰Šé™¤ã™ã‚‹
ã‚¯ãƒ¼ãƒãƒ³ã‚’å‰Šé™¤ã™ã‚‹ã¨ã€ãã®å¾Œã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚„é¡§å®¢ã«é©ç”¨ã§ããªããªã‚Šã¾ã™ã€‚
ãã®ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã—ãŸã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚„é¡§å®¢ã‹ã‚‰å‰²å¼•ãŒå‰Šé™¤ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```php
// Set your secret key. Remember to switch to your live secret key in production.
// See your keys here: https://dashboard.stripe.com/apikeys
$stripe = new \Stripe\StripeClient('Stripeã‚­ãƒ¼');

$stripe->coupons->delete('free-period', []);
```

**çµæœ**
```json
{
  "id": "2bl7i4ct",
  "object": "coupon",
  "deleted": true
}
```

https://docs.stripe.com/api/coupons/delete

### ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
- ã‚¯ãƒ¼ãƒãƒ³ã«ä½œæˆã•ã‚Œã‚‹é¡§å®¢è¡¨ç¤ºç”¨ã®ã‚³ãƒ¼ãƒ‰
- ç‰¹å®šã®é¡§å®¢ã€åˆå›æ³¨æ–‡ã€æœ€å°æ³¨æ–‡å€¤ã€æœ‰åŠ¹æœŸé™ã€ãŠã‚ˆã³å¼•ãæ›ãˆå›æ•°åˆ¶é™ãªã©ã®åˆ¶é™ã‚’æ›¸ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹
- 1ã¤ã®ã‚¯ãƒ¼ãƒãƒ³ã«è¤‡æ•°ã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚
- ä»»æ„ã®è‹±æ•°å­—ã§ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã§ãã¾ã™ã€‚ç‰¹ã«æŒ‡å®šã—ãªã„å ´åˆã¯ãƒ©ãƒ³ãƒ€ãƒ ãªå€¤ã§ç”Ÿæˆã•ã‚Œã¾ã™ã€‚
- ã‚³ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹ã«ã—ãŸã‚Šã€ç„¡åŠ¹ã‚’è§£é™¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**åˆ¶é™**
ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚

- ã™ã§ã«ä½œæˆã—ãŸåŒã˜å€¤ã®ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ç„¡åŠ¹ã«ã—ãŸã‚³ãƒ¼ãƒ‰ã§ã‚ã‚Œã°ã€åŒã˜å€¤ã®ã‚³ãƒ¼ãƒ‰ã§ä½œæˆå¯èƒ½ã§ã™ã€‚
- ã‚³ãƒ¼ãƒ‰ã¯å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ã¾ã›ã‚“ã€‚ãã®ãŸã‚ã€å¤§æ–‡å­—å°æ–‡å­—ãŒç•°ãªã‚‹ã ã‘ã®ã‚³ãƒ¼ãƒ‰ã¯åŒã˜ã‚³ãƒ¼ãƒ‰ã¨ã¿ãªã•ã‚Œç”Ÿæˆä¸å¯ã€‚ä¾‹ãˆã°`test`ã¨`TEST`ã¨ã„ã†ã‚³ãƒ¼ãƒ‰ã¯åŒã˜ã‚³ãƒ¼ãƒ‰æ‰±ã„ã§ã™ã€‚
- é¡§å®¢ã¾ãŸã¯ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®æ›´æ–°APIã«ã€é‡‘é¡åˆ¶é™ã®ã‚ã‚‹ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
- ç‰¹å®šã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚„é¡§å®¢ã«ã€ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ã‚¯ãƒ¼ãƒãƒ³ã®ä¸¡æ–¹ã‚’åŒæ™‚ã«é©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
- 2 ã¤ä»¥ä¸Šã®ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’é©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
- ä¸€åº¦ä½œæˆã—ãŸãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®åˆ¶é™ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
    - ã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã§ãã‚‹é¡§å®¢ã‚’æŒ‡å®šã—ãŸå ´åˆã€æ–°ã—ã„é¡§å®¢ã‚’å«ã‚ã‚‹ã“ã¨ã¯ä¸å¯
    - åˆå›ã®ã¿åˆ©ç”¨å¯ã«ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ã€åˆå›ä»¥å¤–ã‚‚åˆ©ç”¨å¯ã«ã™ã‚‹ã“ã¨ã¯ä¸å¯
    - æœŸé™ã‚’æŒ‡å®šã—ãŸã‚³ãƒ¼ãƒ‰ã®æœŸé™ã‚’å¤‰æ›´ä¸å¯

### ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹
ã‚¯ãƒ¼ãƒãƒ³ã®IDã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ãã®ã‚¯ãƒ¼ãƒãƒ³ã«ç´ã¥ããƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã§ãã¾ã™ã€‚

```php
// Set your secret key. Remember to switch to your live secret key in production.
// See your keys here: https://dashboard.stripe.com/apikeys
$stripe = new \Stripe\StripeClient('Stripeã‚­ãƒ¼');

$stripe->promotionCodes->create([
  'coupon' => 'ZQO00CcH',
  'code' => 'ALICE20',
  'customer' => 'cus_4fdAW5ftNQow1a',
]);
```

**çµæœ**
```json

```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|-------|------|
| coupon | å¿…é ˆã€‚ã‚¯ãƒ¼ãƒãƒ³ID |
| code | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã€‚é¡§å®¢ã«è¦‹ã›ã‚‹ç”¨ã®ã‚³ãƒ¼ãƒ‰ã€‚æŒ‡å®šã—ãªã„å ´åˆã¯ãƒ©ãƒ³ãƒ€ãƒ ãªè‹±æ•°å­—ã§ç”Ÿæˆã•ã‚Œã¾ã™ã€‚ |
| metadata | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ |
| active | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®æœ‰åŠ¹ç„¡åŠ¹è¨­å®šã€‚trueï¼šæœ‰åŠ¹ã€falseï¼šç„¡åŠ¹ |
| customer | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ç´ã¥ã‘ã‚‹é¡§å®¢ã®IDã€‚ç´ã¥ã‘ãŸé¡§å®¢ã®ã¿åˆ©ç”¨å¯èƒ½ã€‚æŒ‡å®šã—ãªã„å ´åˆã¯ã™ã¹ã¦ã®é¡§å®¢ãŒåˆ©ç”¨å¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚ |
| expires_at | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®æœ‰åŠ¹æœŸé™ã€‚ã‚¯ãƒ¼ãƒãƒ³ã«æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã€‚ãã‚Œã‚’è¶…ãˆãŸæœŸé™ã‚’è¨­å®šã§ãã¾ã›ã‚“ã€‚ |
| max_redemptions | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å¼•ãæ›ãˆå›æ•°ã€‚ã‚¯ãƒ¼ãƒãƒ³ã®å¼•ãæ›ãˆå›æ•°ã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã€‚ãã‚Œã‚’è¶…ãˆã‚‹å€¤ã‚’è¨­å®šã§ãã¾ã›ã‚“ã€‚ |
| restrictions | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®å¼•ãæ›ãˆã‚’åˆ¶é™ã™ã‚‹è¨­å®šå€¤ã€‚æ§‹é€ ä½“å½¢å¼ã§åˆ¶é™é …ç›®ã‚’æŒ‡å®šã—ã¾ã™ã€‚ |

**restrictions**
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
|-------|------|
| currency_options | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨å¯èƒ½ã¨ãªã‚‹æœ€ä½é‡‘é¡ã®æŒ‡å®šã€‚è¤‡æ•°é€šè²¨ã®è¨­å®šã¯å®šé¡å‰²å¼•ã®ã¿åˆ©ç”¨å¯èƒ½ã€‚é€šè²¨æ¯ã«æŒ‡å®šå¯èƒ½ã§ã€ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¯¾ã—ã¦æ§‹é€ ä½“ã‚’è¨­å®šã™ã‚‹ã€‚3æ¡ã®é€šè²¨ã‚³ãƒ¼ãƒ‰ã‚’ã‚­ãƒ¼ã«é‡‘é¡ã‚’æŒ‡å®šã—ã¾ã™ã€‚â€» |
| first_time_transaction | é¡§å®¢æ¯ã«åˆå›ã®è³¼å…¥ã®ã¿é©ç”¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’æŒ‡å®šã€‚ |
| minimum_amount | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨å¯èƒ½ã¨ãªã‚‹æœ€ä½é‡‘é¡ã®æŒ‡å®šã€‚ |
| minimum_amount_currency | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’åˆ©ç”¨å¯èƒ½ã¨ãªã‚‹æœ€ä½é‡‘é¡ã®é€šè²¨ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã€‚ |

**â€»restrictionsã®ä¾‹**
- æœ€ä½100å††ä»¥ä¸Šã®è³¼å…¥ãŒå¿…è¦ãªå ´åˆï¼‹åˆå›è³¼å…¥ã®ã¿åˆ¶é™
```json
{
  ãƒ»ãƒ»ãƒ»ä¸­ç•¥ãƒ»ãƒ»ãƒ»
  "restrictions": {
    "first_time_transaction": true,
    "minimum_amount": 100,
    "minimum_amount_currency": "jpy"
  },
  "times_redeemed": 0
}
```

- è¤‡æ•°é€šè²¨ã®é‡‘é¡è¨­å®šã—ãŸå ´åˆã€‚
  105å††ä»¥ä¸Šã€0.05ç±³ãƒ‰ãƒ«ä»¥ä¸Šã¨ã—ãŸå ´åˆã€‚
  ãƒ‰ãƒ«ãªã©å°æ•°ç‚¹ã‚’å«ã‚€é€šè²¨ã¯å°æ•°ç‚¹ãªã—ã§100å€ã•ã‚ŒãŸæ•°å€¤ã§å–å¾—ã™ã‚‹ãŸã‚ã€APIã§å–å¾—ã—ãŸå€¤ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚
  ä¾‹ãˆã°12.34ãƒ‰ãƒ«ã¨è¨­å®šã—ãŸå ´åˆã¯1234ã¨ã„ã†æ•°å€¤ã§è¿”ã•ã‚Œã¾ã™ã€‚
```json
{
  ãƒ»ãƒ»ãƒ»ä¸­ç•¥ãƒ»ãƒ»ãƒ»
  "restrictions": {
    "currency_options": {
      "jpy": {
        "minimum_amount": 105
      },
      "usd": {
        "minimum_amount": 5
      }
    },
    "minimum_amount": 105,
    "minimum_amount_currency": "jpy"
  },
  "times_redeemed": 0
}
```

https://docs.stripe.com/api/promotion_codes/create

:::message
**ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µã«ã¤ã„ã¦**
`currency_options`ã®é …ç›®ã¯ã€APIã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸéš›ã€é€šå¸¸ã¯çµæœã«å«ã¾ã‚Œã¾ã›ã‚“ã€‚
Expanding Responsesï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ‹¡å¼µï¼‰ã¨ã„ã†ä»•çµ„ã¿ã‚’ç”¨ã„ã¦ã€APIã®å®Ÿè¡Œæ™‚ã«æ˜ç¤ºçš„ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹æƒ…å ±ã‚’æ‹¡å¼µã™ã‚‹æŒ‡ç¤ºã‚’å‡ºã™ã“ã¨ã§ã€çµæœã«æƒ…å ±ãŒå«ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
é€šå¸¸ã®APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§ã¯ã€ã‚ã¾ã‚Šåˆ©ç”¨ã•ã‚Œãªã„ã‚ˆã†ãªæƒ…å ±ã‚’æ¸›ã‚‰ã™ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿é‡ã‚’æ¸›ã‚‰ã™äº‹ãŒç›®çš„ã ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚
ã©ã®é …ç›®ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µã«è©²å½“ã™ã‚‹ã‹ã¯APIã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ç¢ºèªã§ãã¾ã™ã€‚
ä¾‹ãˆã°ã€ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ä½œæˆAPIã®å ´åˆã€'Returns'ã®éƒ¨åˆ†ã§ä½•ã‚’æˆ»ã™ã‹ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚
ãŸã„ã¦ã„ã¯ä½•ã‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæ§‹é€ ä½“ï¼‰ã®å½¢ã§è¿”ã™ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
å¤§æŠµã¯å„APIã®å°‘ã—ä¸Šã®æ–¹ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ä½œæˆAPIã‚’ä¾‹ã«è§£èª¬ã—ã¾ã™ã€‚
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚
https://docs.stripe.com/api/promotion_codes/object

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹æˆã™ã‚‹å±æ€§ãŒæ²¢å±±ä¸¦ã‚“ã§ã„ã¾ã™ãŒã€é …ç›®ã®å³å´ã«`Expandable`ã¨æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚‚ã®ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µé …ç›®ã§ã‚ã‚Šã€é€šå¸¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ã¯å«ã¾ã‚Œãªã„é …ç›®ã§ã™ã€‚

ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ä½œæˆAPIã§ã¯`customer`ã¨`currency_options`ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µé …ç›®ã§ã™ã€‚
ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’å…¨éƒ¨æ¬²ã—ã„å ´åˆã«ã€ãƒ‡ãƒ¼ã‚¿å–å¾—APIå‘¼ã³å‡ºã—æ™‚ã«`expand`ã¨ã„ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ‹¡å¼µé …ç›®ã‚‚å«ã‚ãŸå½¢ã§çµæœãŒè¿”ã•ã‚Œã¾ã™ã€‚

```php
$stripe = new \Stripe\StripeClient("Stripeã‚­ãƒ¼");
$stripe->promotionCodes->retrieve(
  'ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰',
  ['expand' => ['customer', 'restrictions.currency_options']]
);
```

@[card](https://docs.stripe.com/api/expanding_objects)
:::


## å°ãƒã‚¿
â€ å®šé¡å‰²å¼•ã§ä¸Šé™ã‚’è¶…ãˆãŸé‡‘é¡ã‚’è¨­å®šã—ãŸéš›ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€é€šè²¨ã®éƒ¨åˆ†ãŒå…¥åŠ›ã—ãŸé‡‘é¡ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/3ca3f693dd43-20240309.png)


## å‚è€ƒè³‡æ–™
**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®å‰²å¼•**
https://docs.stripe.com/billing/subscriptions/coupons
**Stripeï¼šæ–™é‡‘ä½“ç³»**
https://stripe.com/jp/pricing
**Stripeï¼šã‚¯ãƒ¼ãƒãƒ³ã®API**
https://docs.stripe.com/api/coupons
**Stripeï¼šCheckoutã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦**
https://docs.stripe.com/payments/checkout/how-checkout-works?locale=ja-JP
